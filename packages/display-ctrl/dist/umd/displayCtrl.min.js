!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports):"function"==typeof define&&define.amd?define(["exports"],o):o((e="undefined"!=typeof globalThis?globalThis:e||self).displayCtrl={})}(this,(function(e){"use strict";var o=function(){function e(){this.keys=new Proxy({},{get:function(e,o){return o}}),this._sigCtrlCache={},this._sigCtrlShowCfgMap={},this._ctrlClassMap={}}return Object.defineProperty(e.prototype,"sigCtrlCache",{get:function(){return this._sigCtrlCache},enumerable:!1,configurable:!0}),e.prototype.getCtrlClass=function(e){return this._ctrlClassMap[e]},e.prototype.init=function(e){this._resHandler||(this._resHandler=e)},e.prototype.registTypes=function(e){if(e)if("number"==typeof e.length&&e.length)for(var o=0;o<e.length;o++)this.regist(e[o]);else for(var t in e)this.regist(e[t],t)},e.prototype.regist=function(e,o){var t=this._ctrlClassMap;if(!e.typeKey){if(!o)return void console.error("typeKey is null");e.typeKey=o}t[e.typeKey]?console.error("type:"+e.typeKey+" is exit"):t[e.typeKey]=e},e.prototype.isRegisted=function(e){return!!this._ctrlClassMap[e]},e.prototype.getDpcRessInClass=function(e){var o=this._ctrlClassMap[e];return o?o.ress:void console.error("This class :"+e+" is not registered ")},e.prototype.getSigDpcRess=function(e){var o=this.getSigDpcIns(e);return o?o.getRess():null},e.prototype.loadSigDpc=function(e,o){var t=this.getSigDpcIns(e);return t&&this.loadDpcByIns(t,o),t},e.prototype.getSigDpcIns=function(e){var o=this._sigCtrlCache;if(!e)return null;var t=o[e];return t||(t=t||this.insDpc(e))&&(o[e]=t),t},e.prototype.initSigDpc=function(e,o){var t;return t=this.getSigDpcIns(e),this.initDpcByIns(t,o),t},e.prototype.showDpc=function(e,o,t,n,i,s,r,a,d){var l,p=this;if("string"==typeof e)l={typeKey:e,onShowData:o,showedCb:t,onInitData:n,forceLoad:i,onLoadData:s,showEndCb:a,loadCb:r,onCancel:d};else{if("object"!=typeof e)return void console.warn("unknown showDpc",e);l=e,void 0!==o&&(l.onShowData=o),void 0!==t&&(l.showedCb=t),void 0!==a&&(l.showEndCb=a),void 0!==n&&(l.onInitData=n),void 0!==i&&(l.forceLoad=i),void 0!==s&&(l.onLoadData=s),void 0!==r&&(l.loadCb=r),void 0!==d&&(l.onCancel=d)}var c=this.getSigDpcIns(l.typeKey);if(!c)return console.error("There is no registration :typeKey:"+l.typeKey),null;c.needShow=!0;var y=this._sigCtrlShowCfgMap,h=y[l.typeKey];if(h&&l?(h.onCancel&&h.onCancel(),Object.assign(h,l)):y[l.typeKey]=l,c.needLoad||l.forceLoad?(c.isLoaded=!1,c.needLoad=!0):c.isLoaded||c.isLoading||(c.needLoad=!0),c.needLoad){var u=l,f=u.loadCb;u.loadCb=function(e){if(f&&f(e),e){var o=y[l.typeKey];e.needShow&&(p.initDpcByIns(e,o),p.showDpcByIns(e,o),e.needShow=!1)}delete y[l.typeKey]},c.needLoad=!1,this._loadRess(c,u)}else c.isInited||this.initDpcByIns(c,l.onInitData),c.isInited&&(this.showDpcByIns(c,l),c.needShow=!1);return c},e.prototype.updateDpc=function(e,o){if(e){var t=this._sigCtrlCache[e];t&&t.isInited?t.onUpdate(o):console.warn(" updateDpc key:"+e+", The instance is not initialized")}else console.warn("!!!key is null")},e.prototype.hideDpc=function(e){if(e){var o=this._sigCtrlCache[e];o?this.hideDpcByIns(o):console.warn(e+" Not instantiate")}else console.warn("!!!key is null")},e.prototype.destroyDpc=function(e,o){if(e&&""!==e){var t=this._sigCtrlCache[e];this.destroyDpcByIns(t,o),delete this._sigCtrlCache[e]}else console.warn("!!!key is null")},e.prototype.isLoading=function(e){if(e){var o=this._sigCtrlCache[e];return!!o&&o.isLoading}console.warn("!!!key is null")},e.prototype.isLoaded=function(e){if(e){var o=this._sigCtrlCache[e];return!!o&&o.isLoaded}console.warn("!!!key is null")},e.prototype.isInited=function(e){if(e){var o=this._sigCtrlCache[e];return!!o&&o.isInited}console.warn("!!!key is null")},e.prototype.isShowed=function(e){if(!e)return console.warn("!!!key is null"),!1;var o=this._sigCtrlCache[e];return!!o&&o.isShowed},e.prototype.insDpc=function(e){var o=this._ctrlClassMap[e];if(!o)return console.error("Not instantiate:"+e),null;var t=new o;return t.key=e,t},e.prototype.loadDpcByIns=function(e,o){e&&(e.needLoad||o&&o.forceLoad?(e.isLoaded=!1,e.needLoad=!0):e.isLoaded||e.isLoading||(e.needLoad=!0),e.needLoad&&(e.needLoad=!1,this._loadRess(e,o)))},e.prototype.initDpcByIns=function(e,o){e&&(e.isInited||(e.isInited=!0,e.onInit&&e.onInit(o)))},e.prototype.showDpcByIns=function(e,o){e.onShow&&e.onShow(o),e.isShowed=!0,o.showedCb&&o.showedCb(e)},e.prototype.hideDpcByIns=function(e){e&&(e.needShow=!1,e.onHide&&e.onHide(),e.isShowed=!1)},e.prototype.destroyDpcByIns=function(e,o){if(e&&(e.isInited&&(e.isLoaded=!1,e.isInited=!1,e.needShow=!1),e.isShowed&&this.hideDpcByIns(e),e.onDestroy&&e.onDestroy(o),o)){var t=e;t.releaseRes?t.releaseRes(e):this._resHandler&&this._resHandler.releaseRes&&this._resHandler.releaseRes(e)}},e.prototype._loadRess=function(e,o){if(e)if(e.isLoaded)e.isLoaded=!0,e.isLoading=!1,o&&(null==o||o.loadCb(e));else{var t=o||{};isNaN(t.loadCount)&&(t.loadCount=0),t.loadCount++;var n=function(){t.loadCount--,0===t.loadCount&&(e.isLoaded=!0,e.isLoading=!1,o&&(null==o||o.loadCb(e)))},i=function(){t.loadCount--,0===t.loadCount&&(e.isLoaded=!1,e.isLoading=!1,o&&(null==o||o.loadCb(null)))},s=e;e.isLoading=!0,e.isLoaded=!1;var r=o&&o.onLoadData;if(r=e.onLoadData?Object.assign(e.onLoadData,r):r,s.loadRes)s.loadRes({key:e.key,complete:n,error:i,onLoadData:r});else if(this._resHandler){var a=e.getRess?e.getRess():null;if(!a||!a.length)return void n();this._resHandler.loadRes({key:e.key,ress:a,complete:n,error:i,onLoadData:r})}else e.isLoaded=!1,e.isLoading=!1,i(),console.error("load fail:"+e.key)}},e}();e.DpcMgr=o,Object.defineProperty(e,"__esModule",{value:!0})}));var globalTarget=window||global;globalTarget.displayCtrl?Object.assign({},globalTarget.displayCtrl):globalTarget.displayCtrl=displayCtrl;

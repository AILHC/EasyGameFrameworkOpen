var broadcast=function(t){"use strict";var e=function(){function t(){this.keys=new Proxy({},{get:function(t,e){return e}}),this._valueMap={},this._unuseHandlers=[]}return t.prototype.on=function(t,e,r,n,a){if("string"==typeof t){if(!e)return;this._addHandler(this._getHandler(t,e,r,n,a))}else if(this._isArr(t))for(var i=t,s=0;s<i.length;s++)this._addHandler(i[s]);else this._addHandler(t)},t.prototype.has=function(t){return this._handlerMap&&!!this._handlerMap[t]},t.prototype.offAllByContext=function(t){var e=this._handlerMap;if(t&&e)for(var r in e)e[r]&&this.off(r,null,t)},t.prototype.offAll=function(t){if(!this._isStringNull(t)){var e=this._handlerMap,r=this._stickHandlersMap,n=this._valueMap;if(r&&(r[t]=void 0),e){var a=e[t];if(this._isArr(a))for(var i=0;i<a.length;i++)this._recoverHandler(a[i]);else this._recoverHandler(a);e[t]=void 0}n&&(n[t]=void 0)}},t.prototype.off=function(t,e,r,n){if(!this._isStringNull(t)){var a=this._handlerMap;if(!a||!a[t])return this;var i=a[t];if(null!=i){var s=void 0;if(this._isArr(i)){for(var o=(s=i).length-1,l=o;l>=0;l--)!(i=s[l])||r&&i.context!==r||null!=e&&i.listener!==e||n&&!i.once||(l!==(o=s.length-1)&&(i=s[o],s[o]=s[l],s[l]=i),this._recoverHandler(s.pop()));s.length||(a[t]=void 0)}else r&&i.context!==r||null!=e&&i.listener!==e||n&&!i.once||(this._recoverHandler(i),a[t]=void 0)}return this}},t.prototype.broadcast=function(e,r,n,a){var i=this._handlerMap;if(i){var s=i[e];if(a){var o=this._valueMap;o||(o={},this._valueMap=o),o[e]=r}if(s)if(this._isArr(s)){for(var l=s,h=(u=void 0,l.length-1),d=h;d>=0;d--)u=l[d],r?t._runHandlerWithData(u,r,n):t._runHandler(u,n),u.once&&(u=l[h=l.length-1],l[h]=l[d],l[d]=u,this._recoverHandler(l.pop()));l.length||(this._handlerMap[e]=void 0)}else{var u=s;r?t._runHandlerWithData(u,r,n):t._runHandler(u,n),u.once&&(this._recoverHandler(u),this._handlerMap[e]=void 0)}}},t.prototype.stickyBroadcast=function(t,e,r,n){if(!this._isStringNull(t)){var a=this._handlerMap;if(a&&a[t])this.broadcast(t,e,r,n);else{var i=this._stickHandlersMap;i||(i={},this._stickHandlersMap=i);var s=i[t],o={key:t,value:e,callback:r,persistence:n};s?s.push(o):i[t]=[o]}}},t.prototype._isStringNull=function(t){return!t||""===t.trim()},t.prototype._isArr=function(t){return"[object Array]"===Object.prototype.toString.call(t)},t._runHandlerWithData=function(t,e,r){if(null==t.listener)return null;var n;if(null==e){var a=t.args?t.args.unshift(r):[r];n=t.listener.apply(t.context,a)}else n=(t.args||e.unshift)&&t.args?t.listener.apply(t.context,[e,r].concat(t.args)):t.listener.apply(t.context,[e,r]);return n},t._runHandler=function(t,e){if(null==t.listener)return null;var r=t.args?t.args.unshift(e):[e];return t.listener.apply(t.context,r)},t.prototype._recoverHandler=function(t){t.args=void 0,t.context=void 0,t.listener=void 0,t.key=void 0,this._unuseHandlers.push(t)},t.prototype._getHandler=function(t,e,r,n,a){var i,s=this._unuseHandlers;return(i=s.length?s.pop():{}).key=t,i.listener=e,i.context=r,i.once=n,i.args=a,i},t.prototype._addHandler=function(t){var e=this._handlerMap;t.once&&this.off(t.key,t.listener,t.context,t.once),e||(e={},this._handlerMap=e);var r=e[t.key];r?this._isArr(r)?r.push(t):e[t.key]=[r,t]:e[t.key]=t;var n=this._stickHandlersMap;if(n){var a=n[t.key];if(a){for(var i,s=0;s<a.length;s++)i=a[s],this.broadcast(i.key,i.value,i.callback,i.persistence);n[i.key]=void 0}}t.key!==this.keys.onListenerOn&&this.broadcast(this.keys.onListenerOn,t.key)},t.prototype.value=function(t){return this._valueMap&&this._valueMap[t]},t.prototype.dispose=function(){this._handlerMap=void 0,this._stickHandlersMap=void 0,this._valueMap=void 0},t}();return t.Broadcast=e,Object.defineProperty(t,"__esModule",{value:!0}),t}({});const globalTarget=window||global;globalTarget.broadcast?Object.assign({},globalTarget.broadcast):globalTarget.broadcast=broadcast;

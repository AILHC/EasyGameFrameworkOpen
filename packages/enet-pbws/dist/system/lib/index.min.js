System.register("@ailhc/enet-pbws",[],(function(t){"use strict";return{execute:function(){t("PackageType",void 0);var e,r=t("Byte",function(){function t(t){void 0===t&&(t=null),this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this._resizeBuffer(this._allocated_)}return t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?t.LITTLE_ENDIAN:t.BIG_ENDIAN}return t._sysEndian},Object.defineProperty(t.prototype,"buffer",{get:function(){var t=this._d_.buffer;return t.byteLength===this._length?t:t.slice(0,this._length)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"endian",{get:function(){return this._xd_?t.LITTLE_ENDIAN:t.BIG_ENDIAN},set:function(e){this._xd_=e===t.LITTLE_ENDIAN},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._length},set:function(t){this._allocated_<t?this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this._resizeBuffer(this._allocated_=t),this._length=t},enumerable:!1,configurable:!0}),t.prototype._resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(e){throw"Invalid typed array length:"+t}},t.prototype.readString=function(){return this._rUTF(this.readUint16())},t.prototype.readFloat32Array=function(t,e){var r=t+e;r=r>this._length?this._length:r;var i=new Float32Array(this._d_.buffer.slice(t,r));return this._pos_=r,i},t.prototype.readUint8Array=function(t,e){var r=t+e;r=r>this._length?this._length:r;var i=new Uint8Array(this._d_.buffer.slice(t,r));return this._pos_=r,i},t.prototype.readInt16Array=function(t,e){var r=t+e;r=r>this._length?this._length:r;var i=new Int16Array(this._d_.buffer.slice(t,r));return this._pos_=r,i},t.prototype.readFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},t.prototype.readFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},t.prototype.writeFloat32=function(t){this._ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},t.prototype.writeFloat64=function(t){this._ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},t.prototype.readInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},t.prototype.readUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},t.prototype.readUint32NoError=function(){if(!(this._pos_+4>this._length)){var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t}},t.prototype.writeInt32=function(t){this._ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},t.prototype.writeUint32=function(t){this._ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},t.prototype.readInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},t.prototype.readUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},t.prototype.writeUint16=function(t){this._ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},t.prototype.writeInt16=function(t){this._ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},t.prototype.readUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]},t.prototype.writeUint8=function(t){this._ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},t.prototype._readUInt8=function(t){return this._d_.getUint8(t)},t.prototype._readUint16=function(t){return this._d_.getUint16(t,this._xd_)},t.prototype._rUTF=function(t){var e,r,i=this._pos_+t,s=String.fromCharCode,o=this._u8d_,_=[],n=0;for(_.length=1e3;this._pos_<i;)if((e=o[this._pos_++])<128)0!=e&&(_[n++]=s(e));else if(e<224)_[n++]=s((63&e)<<6|127&o[this._pos_++]);else if(e<240)r=o[this._pos_++],_[n++]=s((31&e)<<12|(127&r)<<6|127&o[this._pos_++]);else{var h=(15&e)<<18|(127&(r=o[this._pos_++]))<<12|(127&o[this._pos_++])<<6|127&o[this._pos_++];if(h>=65536){var p=h-65536,a=55296|p>>10,u=56320|1023&p;_[n++]=s(a),_[n++]=s(u)}else _[n++]=s(h)}return _.length=n,_.join("")},t.prototype.readCustomString=function(t){for(var e,r="",i=0,s=String.fromCharCode,o=this._u8d_;t>0;)if((e=o[this._pos_])<128)r+=s(e),this._pos_++,t--;else for(i=e-128,this._pos_++,t-=i;i>0;)e=o[this._pos_++],r+=s(o[this._pos_++]<<8|e),i--;return r},Object.defineProperty(t.prototype,"pos",{get:function(){return this._pos_},set:function(t){this._pos_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bytesAvailable",{get:function(){return this._length-this._pos_},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._pos_=0,this.length=0},t.prototype.__getBuffer=function(){return this._d_.buffer},t.prototype.writeUTFBytes=function(t){for(var e=0,r=(t+="").length;e<r;e++){var i=t.charCodeAt(e);if(i<=127)this.writeByte(i);else if(i<=2047)this._ensureWrite(this._pos_+2),this._u8d_.set([192|i>>6,128|63&i],this._pos_),this._pos_+=2;else if(i>=55296&&i<=56319){e++;var s=t.charCodeAt(e);if(!Number.isNaN(s)&&s>=56320&&s<=57343){var o=64+(1023&i),_=1023&s,n=240|o>>8&63,h=128|o>>2&63,p=128|(3&o)<<4|_>>6&15,a=128|63&_;this._ensureWrite(this._pos_+4),this._u8d_.set([n,h,p,a],this._pos_),this._pos_+=4}}else i<=65535?(this._ensureWrite(this._pos_+3),this._u8d_.set([224|i>>12,128|i>>6&63,128|63&i],this._pos_),this._pos_+=3):(this._ensureWrite(this._pos_+4),this._u8d_.set([240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i],this._pos_),this._pos_+=4)}},t.prototype.writeUTFString=function(t){var e=this.pos;this.writeUint16(1),this.writeUTFBytes(t);var r=this.pos-e-2;this._d_.setUint16(e,r,this._xd_)},t.prototype.writeUTFString32=function(t){var e=this.pos;this.writeUint32(1),this.writeUTFBytes(t);var r=this.pos-e-4;this._d_.setUint32(e,r,this._xd_)},t.prototype.readUTFString=function(){return this.readUTFBytes(this.readUint16())},t.prototype.readUTFString32=function(){return this.readUTFBytes(this.readUint32())},t.prototype.readUTFBytes=function(t){if(void 0===t&&(t=-1),0===t)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";return t=t>0?t:e,this._rUTF(t)},t.prototype.writeByte=function(t){this._ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},t.prototype.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)},t.prototype._ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},t.prototype.writeArrayBuffer=function(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=0),e<0||r<0)throw"writeArrayBuffer error - Out of bounds";0==r&&(r=t.byteLength-e),this._ensureWrite(this._pos_+r);var i=new Uint8Array(t);this._u8d_.set(i.subarray(e,e+r),this._pos_),this._pos_+=r},t.prototype.writeUint8Array=function(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=0),e<0||r<0)throw"writeArrayBuffer error - Out of bounds";0===r&&(r=t.byteLength-e),this._ensureWrite(this._pos_+r),this._u8d_.set(t.subarray(e,e+r),this._pos_),this._pos_+=r},t.prototype.readArrayBuffer=function(t){var e;return e=this._u8d_.buffer.slice(this._pos_,this._pos_+t),this._pos_=this._pos_+t,e},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t._sysEndian=null,t}());!function(t){t[t.HANDSHAKE=1]="HANDSHAKE",t[t.HANDSHAKE_ACK=2]="HANDSHAKE_ACK",t[t.HEARTBEAT=3]="HEARTBEAT",t[t.DATA=4]="DATA",t[t.KICK=5]="KICK"}(e||(e=t("PackageType",{})));t("PbProtoHandler",function(){function t(t,e){if(this._byteUtil=new r,!t)throw"pbProtojs is undefined";this._protoMap=t;var i={};if(e)for(var s=0;s<e.length;s++)i[e[s].type]=e[s];this._pkgTypeProtoKeyMap=i}return Object.defineProperty(t.prototype,"heartbeatConfig",{get:function(){return this._heartbeatCfg},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"handShakeRes",{get:function(){return this._handShakeRes},enumerable:!1,configurable:!0}),t.prototype.setHandshakeRes=function(t){this._handShakeRes=t,this._heartbeatCfg=t},t.prototype.protoKey2Key=function(t){return t},t.prototype._protoEncode=function(t,e){var r,i=this._protoMap[t];if(i){var s=i.verify(e);s?console.error("encode error:",s):r=i.encode(e).finish()}else console.error("no this proto:"+t);return r},t.prototype.encodePkg=function(t,i){var s,o,_=t.type,n=this._byteUtil;if(n.clear(),n.endian=r.LITTLE_ENDIAN,n.writeUint32(_),_===e.DATA){var h=t.data;n.writeUTFString(h.key);var p=h.reqId;n.writeUint32(!isNaN(p)&&p>0?p:0),o=h.data,s=h.key}else{var a=this._pkgTypeProtoKeyMap;s=a[_]&&a[_].encode,o=t.data}if(s&&o){var u=this._protoEncode(s,o);u?n.writeUint8Array(u):n.clear()}var f=n.buffer.byteLength?n.buffer:void 0;return n.clear(),f},t.prototype.encodeMsg=function(t,r){return this.encodePkg({type:e.DATA,data:t},r)},t.prototype.decodePkg=function(t){var i=this._byteUtil;i.clear(),i.endian=r.LITTLE_ENDIAN,t instanceof ArrayBuffer?i.writeArrayBuffer(t):t instanceof Uint8Array&&i.writeUint8Array(t),i.pos=0;var s=i.readUint32(),o={};if(s===e.DATA){var _=i.readUTFString(),n=i.readUint32NoError(),h=i.readUint8Array(i.pos,i.length),p=this._protoMap[_];if(o.reqId=n,o.key=_,p){var a=p.decode(h),u=p.verify(a);o.data=a,o.errorMsg=u,o.type=s}else o.errorMsg="no this proto:"+_}else{var f=this._pkgTypeProtoKeyMap;_=f[s]&&f[s].decode;if(o.key=_,_){h=i.readUint8Array(i.pos,i.length);if(p=this._protoMap[_]){a=p.decode(h),u=p.verify(a);o.data=a,o.errorMsg=u,o.type=s}else o.errorMsg="no this proto:"+_}s===e.HANDSHAKE&&this.setHandshakeRes(o.data)}return o},t}())}}}));

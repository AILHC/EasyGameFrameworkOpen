System.register("@ailhc/display-ctrl",[],(function(e){"use strict";return{execute:function(){e("DpcMgr",function(){function e(){this.keys=new Proxy({},{get:function(e,t){return t}}),this._sigCtrlCache={},this._sigCtrlShowCfgMap={},this._ctrlClassMap={}}return Object.defineProperty(e.prototype,"sigCtrlCache",{get:function(){return this._sigCtrlCache},enumerable:!1,configurable:!0}),e.prototype.getCtrlClass=function(e){return this._ctrlClassMap[e]},e.prototype.init=function(e){this._resHandler||(this._resHandler=e)},e.prototype.registTypes=function(e){if(e)if("number"==typeof e.length&&e.length)for(var t=0;t<e.length;t++)this.regist(e[t]);else for(var o in e)this.regist(e[o],o)},e.prototype.regist=function(e,t){var o=this._ctrlClassMap;if(!e.typeKey){if(!t)return void console.error("typeKey is null");e.typeKey=t}o[e.typeKey]?console.error("type:"+e.typeKey+" is exit"):o[e.typeKey]=e},e.prototype.isRegisted=function(e){return!!this._ctrlClassMap[e]},e.prototype.getDpcRessInClass=function(e){var t=this._ctrlClassMap[e];return t?t.ress:void console.error("This class :"+e+" is not registered ")},e.prototype.getSigDpcRess=function(e){var t=this.getSigDpcIns(e);return t?t.getRess():null},e.prototype.loadSigDpc=function(e,t){var o=this.getSigDpcIns(e);return o&&this.loadDpcByIns(o,t),o},e.prototype.getSigDpcIns=function(e){var t=this._sigCtrlCache;if(!e)return null;var o=t[e];return o||(o=o||this.insDpc(e))&&(t[e]=o),o},e.prototype.initSigDpc=function(e,t){var o;return o=this.getSigDpcIns(e),this.initDpcByIns(o,t),o},e.prototype.showDpc=function(e,t,o,n,i,s,r,a,d){var l,c=this;if("string"==typeof e)l={typeKey:e,onShowData:t,showedCb:o,onInitData:n,forceLoad:i,onLoadData:s,showEndCb:a,loadCb:r,onCancel:d};else{if("object"!=typeof e)return void console.warn("unknown showDpc",e);l=e,void 0!==t&&(l.onShowData=t),void 0!==o&&(l.showedCb=o),void 0!==a&&(l.showEndCb=a),void 0!==n&&(l.onInitData=n),void 0!==i&&(l.forceLoad=i),void 0!==s&&(l.onLoadData=s),void 0!==r&&(l.loadCb=r),void 0!==d&&(l.onCancel=d)}var p=this.getSigDpcIns(l.typeKey);if(!p)return console.error("There is no registration :typeKey:"+l.typeKey),null;p.needShow=!0;var h=this._sigCtrlShowCfgMap,y=h[l.typeKey];if(y&&l?(y.onCancel&&y.onCancel(),Object.assign(y,l)):h[l.typeKey]=l,p.needLoad||l.forceLoad?(p.isLoaded=!1,p.needLoad=!0):p.isLoaded||p.isLoading||(p.needLoad=!0),p.needLoad){var u=l,f=u.loadCb;u.loadCb=function(e){if(f&&f(e),e){var t=h[l.typeKey];e.needShow&&(c.initDpcByIns(e,t),c.showDpcByIns(e,t),e.needShow=!1)}delete h[l.typeKey]},p.needLoad=!1,this._loadRess(p,u)}else p.isInited||this.initDpcByIns(p,l.onInitData),p.isInited&&(this.showDpcByIns(p,l),p.needShow=!1);return p},e.prototype.updateDpc=function(e,t){if(e){var o=this._sigCtrlCache[e];o&&o.isInited?o.onUpdate(t):console.warn(" updateDpc key:"+e+", The instance is not initialized")}else console.warn("!!!key is null")},e.prototype.hideDpc=function(e){if(e){var t=this._sigCtrlCache[e];t?this.hideDpcByIns(t):console.warn(e+" Not instantiate")}else console.warn("!!!key is null")},e.prototype.destroyDpc=function(e,t){if(e&&""!==e){var o=this._sigCtrlCache[e];this.destroyDpcByIns(o,t),delete this._sigCtrlCache[e]}else console.warn("!!!key is null")},e.prototype.isLoading=function(e){if(e){var t=this._sigCtrlCache[e];return!!t&&t.isLoading}console.warn("!!!key is null")},e.prototype.isLoaded=function(e){if(e){var t=this._sigCtrlCache[e];return!!t&&t.isLoaded}console.warn("!!!key is null")},e.prototype.isInited=function(e){if(e){var t=this._sigCtrlCache[e];return!!t&&t.isInited}console.warn("!!!key is null")},e.prototype.isShowed=function(e){if(!e)return console.warn("!!!key is null"),!1;var t=this._sigCtrlCache[e];return!!t&&t.isShowed},e.prototype.isShowEnd=function(e){if(!e)return console.warn("!!!key is null"),!1;var t=this._sigCtrlCache[e];return!!t&&t.isShowed},e.prototype.insDpc=function(e){var t=this._ctrlClassMap[e];if(!t)return console.error("Not instantiate:"+e),null;var o=new t;return o.key=e,o},e.prototype.loadDpcByIns=function(e,t){e&&(e.needLoad||t&&t.forceLoad?(e.isLoaded=!1,e.needLoad=!0):e.isLoaded||e.isLoading||(e.needLoad=!0),e.needLoad&&(e.needLoad=!1,this._loadRess(e,t)))},e.prototype.initDpcByIns=function(e,t){e&&(e.isInited||(e.isInited=!0,e.onInit&&e.onInit(t)))},e.prototype.showDpcByIns=function(e,t){e.onShow&&e.onShow(t),e.isShowed=!0,t.showedCb&&t.showedCb(e)},e.prototype.hideDpcByIns=function(e){e&&(e.needShow=!1,e.onHide&&e.onHide(),e.isShowed=!1)},e.prototype.destroyDpcByIns=function(e,t){if(e&&(e.isInited&&(e.isLoaded=!1,e.isInited=!1,e.needShow=!1),e.isShowed&&this.hideDpcByIns(e),e.onDestroy&&e.onDestroy(t),t)){var o=e;o.releaseRes?o.releaseRes(e):this._resHandler&&this._resHandler.releaseRes&&this._resHandler.releaseRes(e)}},e.prototype._loadRess=function(e,t){if(e)if(e.isLoaded)e.isLoaded=!0,e.isLoading=!1,t&&(null==t||t.loadCb(e));else{var o=t||{};isNaN(o.loadCount)&&(o.loadCount=0),o.loadCount++;var n=function(){o.loadCount--,0===o.loadCount&&(e.isLoaded=!0,e.isLoading=!1,t&&(null==t||t.loadCb(e)))},i=function(){o.loadCount--,0===o.loadCount&&(e.isLoaded=!1,e.isLoading=!1,t&&(null==t||t.loadCb(null)))},s=e;e.isLoading=!0,e.isLoaded=!1;var r=t&&t.onLoadData;if(r=e.onLoadData?Object.assign(e.onLoadData,r):r,s.loadRes)s.loadRes({key:e.key,complete:n,error:i,onLoadData:r});else if(this._resHandler){var a=e.getRess?e.getRess():null;if(!a||!a.length)return void n();this._resHandler.loadRes({key:e.key,ress:a,complete:n,error:i,onLoadData:r})}else e.isLoaded=!1,e.isLoading=!1,i(),console.error("load fail:"+e.key)}},e}())}}}));

{"version":3,"file":"enet.js","sources":["@ailhc/enet/src/default-net-event-handler.ts","@ailhc/enet/src/pkg-type.ts","@ailhc/enet/src/socketStateType.ts","@ailhc/enet/src/wsocket.ts","@ailhc/enet/src/net-node.ts"],"sourcesContent":["export class DefaultNetEventHandler implements enet.INetEventHandler {\n    onStartConnenct?(connectOpt: enet.IConnectOptions): void {\n        console.log(`start connect:${connectOpt.url},opt:`, connectOpt);\n    }\n    onConnectEnd?(connectOpt: enet.IConnectOptions, handshakeRes?: any): void {\n        console.log(`connect ok:${connectOpt.url},opt:`, connectOpt);\n        console.log(`handshakeRes:`, handshakeRes);\n    }\n    onError(event: any, connectOpt: enet.IConnectOptions): void {\n        console.error(`socket error,opt:`, connectOpt);\n        console.error(event);\n    }\n    onClosed(event: any, connectOpt: enet.IConnectOptions): void {\n        console.error(`socket close,opt:`, connectOpt);\n        console.error(event);\n    }\n    onStartReconnect?(reConnectCfg: enet.IReconnectConfig, connectOpt: enet.IConnectOptions): void {\n        console.log(`start reconnect:${connectOpt.url},opt:`, connectOpt);\n    }\n    onReconnecting?(curCount: number, reConnectCfg: enet.IReconnectConfig, connectOpt: enet.IConnectOptions): void {\n        console.log(\n            `url:${connectOpt.url} reconnect count:${curCount},less count:${reConnectCfg.reconnectCount},opt:`,\n            connectOpt\n        );\n    }\n    onReconnectEnd?(isOk: boolean, reConnectCfg: enet.IReconnectConfig, connectOpt: enet.IConnectOptions): void {\n        console.log(`url:${connectOpt.url}reconnect end ${isOk ? \"ok\" : \"fail\"} ,opt:`, connectOpt);\n    }\n    onStartRequest?(reqCfg: enet.IRequestConfig, connectOpt: enet.IConnectOptions): void {\n        console.log(`start request:${reqCfg.protoKey},id:${reqCfg.reqId},opt:`, connectOpt);\n        console.log(`reqCfg:`, reqCfg);\n    }\n    onData?(dpkg: enet.IDecodePackage<any>, connectOpt: enet.IConnectOptions): void {\n        console.log(`data :${dpkg.key},opt:`, connectOpt);\n    }\n    onRequestTimeout?(reqCfg: enet.IRequestConfig, connectOpt: enet.IConnectOptions): void {\n        console.warn(`request timeout:${reqCfg.protoKey},opt:`, connectOpt);\n    }\n    onCustomError?(dpkg: enet.IDecodePackage<any>, connectOpt: enet.IConnectOptions): void {\n        console.error(\n            `proto key:${dpkg.key},reqId:${dpkg.reqId},code:${dpkg.code},errorMsg:${dpkg.errorMsg},opt:`,\n            connectOpt\n        );\n    }\n    onKick(dpkg: enet.IDecodePackage<any>, copt: enet.IConnectOptions) {\n        console.log(`be kick,opt:`, copt);\n    }\n}\n","export enum PackageType {\n    /**握手 */\n    HANDSHAKE = 1,\n    /**握手回应 */\n    HANDSHAKE_ACK = 2,\n    /**心跳 */\n    HEARTBEAT = 3,\n    /**数据 */\n    DATA = 4,\n    /**踢下线 */\n    KICK = 5\n}","export enum SocketState {\n    /**连接中 */\n    CONNECTING,\n    /**打开 */\n    OPEN,\n    /**关闭中 */\n    CLOSING,\n    /**关闭了 */\n    CLOSED\n}","import { SocketState } from \"./socketStateType\";\n\nexport class WSocket implements enet.ISocket {\n    private _sk: WebSocket;\n    private _eventHandler: enet.ISocketEventHandler;\n    public get state(): SocketState {\n        return this._sk ? this._sk.readyState : SocketState.CLOSED;\n    }\n    public get isConnected(): boolean {\n        return this._sk ? this._sk.readyState === SocketState.OPEN : false;\n    }\n    setEventHandler(handler: enet.ISocketEventHandler): void {\n        this._eventHandler = handler;\n    }\n    connect(opt: enet.IConnectOptions): boolean {\n        let url = opt.url;\n        if (!url) {\n            if (opt.host && opt.port) {\n                url = `${opt.protocol ? \"wss\" : \"ws\"}://${opt.host}:${opt.port}`;\n            } else {\n                return false;\n            }\n        }\n        opt.url = url;\n        if (this._sk) {\n            this.close(true);\n        }\n        if (!this._sk) {\n            this._sk = new WebSocket(url);\n            if (!opt.binaryType) {\n                opt.binaryType = \"arraybuffer\";\n            }\n            this._sk.binaryType = opt.binaryType;\n            this._sk.onclose = this._eventHandler?.onSocketClosed && this._eventHandler?.onSocketClosed;\n            this._sk.onerror = this._eventHandler?.onSocketError && this._eventHandler?.onSocketError;\n            this._sk.onmessage = this._eventHandler?.onSocketMsg && this._eventHandler?.onSocketMsg;\n            this._sk.onopen = this._eventHandler?.onSocketConnected && this._eventHandler?.onSocketConnected;\n        }\n    }\n    send(data: enet.NetData): void {\n        if (this._sk) {\n            this._sk.send(data);\n        } else {\n            console.error(`socket is null`);\n        }\n    }\n\n    close(disconnect?: boolean): void {\n        if (this._sk) {\n            const isConnected = this.isConnected;\n            this._sk.close();\n            this._sk.onclose = null;\n            this._sk.onerror = null;\n            this._sk.onmessage = null;\n            this._sk.onopen = null;\n            this._sk = null;\n            if (isConnected) {\n                this._eventHandler?.onSocketClosed && this._eventHandler?.onSocketClosed(disconnect);\n            }\n        }\n    }\n}\n","import { DefaultNetEventHandler } from \"./default-net-event-handler\";\nimport { PackageType } from \"./pkg-type\";\nimport { SocketState } from \"./socketStateType\";\nimport { WSocket } from \"./wsocket\";\n\nexport class NetNode<ProtoKeyType> implements enet.INode<ProtoKeyType> {\n    /**\n     * 套接字实现\n     */\n    protected _socket: enet.ISocket;\n    public get socket(): enet.ISocket {\n        return this._socket;\n    }\n    /**\n     * 网络事件处理器\n     */\n    protected _netEventHandler: enet.INetEventHandler;\n    public get netEventHandler(): enet.INetEventHandler<any> {\n        return this._netEventHandler;\n    }\n    /**\n     * 协议处理器\n     */\n    protected _protoHandler: enet.IProtoHandler;\n    public get protoHandler(): enet.IProtoHandler<any> {\n        return this._protoHandler;\n    }\n    /**\n     * 当前重连次数\n     */\n    protected _curReconnectCount: number = 0;\n    /**\n     * 重连配置\n     */\n    protected _reConnectCfg: enet.IReconnectConfig;\n    /**\n     * 是否初始化\n     */\n    protected _inited: boolean;\n    /**\n     * 连接参数对象\n     */\n    protected _connectOpt: enet.IConnectOptions;\n    /**\n     * 是否正在重连\n     */\n    protected _isReconnecting: boolean;\n    /**\n     * 计时器id\n     */\n    protected _reconnectTimerId: any;\n    /**\n     * 请求id\n     * 会自增\n     */\n    protected _reqId: number = 1;\n    /**\n     * 永久监听处理器字典\n     * key为请求key  = protoKey\n     * value为 回调处理器或回调函数\n     */\n    protected _pushHandlerMap: { [key: string]: enet.AnyCallback[] };\n    /**\n     * 一次监听推送处理器字典\n     * key为请求key  = protoKey\n     * value为 回调处理器或回调函数\n     */\n    protected _oncePushHandlerMap: { [key: string]: enet.AnyCallback[] };\n    /**\n     * 请求响应回调字典\n     * key为请求key  = protoKey_reqId\n     * value为 回调处理器或回调函数\n     */\n    protected _reqCfgMap: { [key: number]: enet.IRequestConfig };\n    /**socket事件处理器 */\n    protected _socketEventHandler: enet.ISocketEventHandler;\n\n    /**\n     * 获取socket事件处理器\n     */\n    protected get socketEventHandler(): enet.ISocketEventHandler {\n        if (!this._socketEventHandler) {\n            this._socketEventHandler = {\n                onSocketClosed: this._onSocketClosed.bind(this),\n                onSocketConnected: this._onSocketConnected.bind(this),\n                onSocketError: this._onSocketError.bind(this),\n                onSocketMsg: this._onSocketMsg.bind(this)\n            };\n        }\n\n        return this._socketEventHandler;\n    }\n    /**数据包类型处理 */\n    protected _pkgTypeHandlers: { [key: number]: (dpkg: enet.IDecodePackage) => void };\n    /**心跳配置 */\n    protected _heartbeatConfig: enet.IHeartBeatConfig;\n    /**心跳间隔阈值 默认100毫秒 */\n    protected _gapThreashold: number;\n    /**使用加密 */\n    protected _useCrypto: boolean;\n\n    public init(config?: enet.INodeConfig): void {\n        if (this._inited) return;\n\n        this._protoHandler = config && config.protoHandler ? config.protoHandler : new DefaultProtoHandler();\n        this._socket = config && config.socket ? config.socket : new WSocket();\n        this._netEventHandler =\n            config && config.netEventHandler ? config.netEventHandler : new DefaultNetEventHandler();\n        this._pushHandlerMap = {};\n        this._oncePushHandlerMap = {};\n        this._reqCfgMap = {};\n        const reConnectCfg = config && config.reConnectCfg;\n        if (!reConnectCfg) {\n            this._reConnectCfg = {\n                reconnectCount: 4,\n                connectTimeout: 60000\n            };\n        } else {\n            this._reConnectCfg = reConnectCfg;\n            if (isNaN(reConnectCfg.reconnectCount)) {\n                this._reConnectCfg.reconnectCount = 4;\n            }\n            if (isNaN(reConnectCfg.connectTimeout)) {\n                this._reConnectCfg.connectTimeout = 60000;\n            }\n        }\n        this._gapThreashold = config && !isNaN(config.heartbeatGapThreashold) ? config.heartbeatGapThreashold : 100;\n        this._useCrypto = config && config.useCrypto;\n        this._inited = true;\n\n        this._socket.setEventHandler(this.socketEventHandler);\n\n        this._pkgTypeHandlers = {};\n        this._pkgTypeHandlers[PackageType.HANDSHAKE] = this._onHandshake.bind(this);\n        this._pkgTypeHandlers[PackageType.HEARTBEAT] = this._heartbeat.bind(this);\n        this._pkgTypeHandlers[PackageType.DATA] = this._onData.bind(this);\n        this._pkgTypeHandlers[PackageType.KICK] = this._onKick.bind(this);\n    }\n\n    public connect(option: string | enet.IConnectOptions, connectEnd?: VoidFunction): void {\n        const socket = this._socket;\n        const socketInCloseState =\n            socket && (socket.state === SocketState.CLOSING || socket.state === SocketState.CLOSED);\n        if (this._inited && socketInCloseState) {\n            if (typeof option === \"string\") {\n                option = {\n                    url: option,\n                    connectEnd: connectEnd\n                };\n            }\n            if (connectEnd) {\n                option.connectEnd = connectEnd;\n            }\n            this._connectOpt = option;\n\n            this._socket.connect(option);\n            const netEventHandler = this._netEventHandler;\n            netEventHandler.onStartConnenct && netEventHandler.onStartConnenct(option);\n        } else {\n            console.error(`is not inited${socket ? \" , socket state\" + socket.state : \"\"}`);\n        }\n    }\n    public disConnect(): void {\n        this._socket.close(true);\n\n        //清理心跳定时器\n        if (this._heartbeatTimeId) {\n            clearTimeout(this._heartbeatTimeId);\n            this._heartbeatTimeId = undefined;\n        }\n        if (this._heartbeatTimeoutId) {\n            clearTimeout(this._heartbeatTimeoutId);\n            this._heartbeatTimeoutId = undefined;\n        }\n    }\n\n    public reConnect(): void {\n        if (!this._inited || !this._socket) {\n            return;\n        }\n        if (this._curReconnectCount > this._reConnectCfg.reconnectCount) {\n            this._stopReconnect(false);\n            return;\n        }\n        if (!this._isReconnecting) {\n            const netEventHandler = this._netEventHandler;\n            netEventHandler.onStartReconnect && netEventHandler.onStartReconnect(this._reConnectCfg, this._connectOpt);\n        }\n        this._isReconnecting = true;\n        this.connect(this._connectOpt);\n\n        this._curReconnectCount++;\n        const netEventHandler = this._netEventHandler;\n        netEventHandler.onReconnecting &&\n            netEventHandler.onReconnecting(this._curReconnectCount, this._reConnectCfg, this._connectOpt);\n        this._reconnectTimerId = setTimeout(() => {\n            this.reConnect();\n        }, this._reConnectCfg.connectTimeout);\n    }\n    public request<ReqData = any, ResData = any>(\n        protoKey: ProtoKeyType,\n        data: ReqData,\n        resHandler:\n            | enet.ICallbackHandler<enet.IDecodePackage<ResData>>\n            | enet.ValueCallback<enet.IDecodePackage<ResData>>,\n        arg?: any\n    ): void {\n        if (!this._isSocketReady()) return;\n        const reqId = this._reqId;\n        const protoHandler = this._protoHandler;\n        const encodePkg = protoHandler.encodeMsg({ key: protoKey, reqId: reqId, data: data }, this._useCrypto);\n        if (encodePkg) {\n            let reqCfg: enet.IRequestConfig = {\n                reqId: reqId,\n                protoKey: protoHandler.protoKey2Key(protoKey),\n                data: data,\n                resHandler: resHandler\n            };\n            if (arg) reqCfg = Object.assign(reqCfg, arg);\n            this._reqCfgMap[reqId] = reqCfg;\n            this._reqId++;\n            this._netEventHandler.onStartRequest && this._netEventHandler.onStartRequest(reqCfg, this._connectOpt);\n            this.send(encodePkg);\n        }\n    }\n    public notify<T>(protoKey: ProtoKeyType, data?: T): void {\n        if (!this._isSocketReady()) return;\n\n        const encodePkg = this._protoHandler.encodeMsg(\n            {\n                key: protoKey,\n                data: data\n            } as enet.IMessage,\n            this._useCrypto\n        );\n\n        this.send(encodePkg);\n    }\n    public send(netData: enet.NetData): void {\n        this._socket.send(netData);\n    }\n    public onPush<ResData = any>(\n        protoKey: ProtoKeyType,\n        handler: enet.ICallbackHandler<enet.IDecodePackage<ResData>> | enet.ValueCallback<enet.IDecodePackage<ResData>>\n    ): void {\n        const key = this._protoHandler.protoKey2Key(protoKey);\n        if (!this._pushHandlerMap[key]) {\n            this._pushHandlerMap[key] = [handler];\n        } else {\n            this._pushHandlerMap[key].push(handler);\n        }\n    }\n    public oncePush<ResData = any>(\n        protoKey: ProtoKeyType,\n        handler: enet.ICallbackHandler<enet.IDecodePackage<ResData>> | enet.ValueCallback<enet.IDecodePackage<ResData>>\n    ): void {\n        const key = this._protoHandler.protoKey2Key(protoKey);\n        if (!this._oncePushHandlerMap[key]) {\n            this._oncePushHandlerMap[key] = [handler];\n        } else {\n            this._oncePushHandlerMap[key].push(handler);\n        }\n    }\n    public offPush(protoKey: ProtoKeyType, callbackHandler: enet.AnyCallback, context?: any, onceOnly?: boolean): void {\n        const key = this._protoHandler.protoKey2Key(protoKey);\n        let handlers: enet.AnyCallback[];\n        if (onceOnly) {\n            handlers = this._oncePushHandlerMap[key];\n        } else {\n            handlers = this._pushHandlerMap[key];\n        }\n        if (handlers) {\n            let handler: enet.AnyCallback;\n            let isEqual: boolean;\n            for (let i = handlers.length - 1; i > -1; i--) {\n                handler = handlers[i];\n                isEqual = false;\n                if (typeof handler === \"function\" && handler === callbackHandler) {\n                    isEqual = true;\n                } else if (\n                    typeof handler === \"object\" &&\n                    handler.method === callbackHandler &&\n                    (!context || context === handler.context)\n                ) {\n                    isEqual = true;\n                }\n                if (isEqual) {\n                    if (i !== handlers.length) {\n                        handlers[i] = handlers[handlers.length - 1];\n                        handlers[handlers.length - 1] = handler;\n                    }\n                    handlers.pop();\n                }\n            }\n        }\n    }\n    public offPushAll(protoKey?: ProtoKeyType): void {\n        if (protoKey) {\n            const key = this._protoHandler.protoKey2Key(protoKey);\n            delete this._pushHandlerMap[key];\n            delete this._oncePushHandlerMap[key];\n        } else {\n            this._pushHandlerMap = {};\n            this._oncePushHandlerMap = {};\n        }\n    }\n    /**\n     * 握手包处理\n     * @param dpkg\n     */\n    protected _onHandshake(dpkg: enet.IDecodePackage) {\n        if (dpkg.errorMsg) {\n            return;\n        }\n        this._handshakeInit(dpkg);\n        const ackPkg = this._protoHandler.encodePkg({ type: PackageType.HANDSHAKE_ACK });\n        this.send(ackPkg);\n        const connectOpt = this._connectOpt;\n        const handshakeRes = this._protoHandler.handShakeRes;\n        connectOpt.connectEnd && connectOpt.connectEnd(handshakeRes);\n        this._netEventHandler.onConnectEnd && this._netEventHandler.onConnectEnd(connectOpt, handshakeRes);\n    }\n    /**\n     * 握手初始化\n     * @param dpkg\n     */\n    protected _handshakeInit(dpkg: enet.IDecodePackage) {\n        const heartbeatCfg = this.protoHandler.heartbeatConfig;\n\n        this._heartbeatConfig = heartbeatCfg;\n    }\n    /**心跳超时定时器id */\n    protected _heartbeatTimeoutId: number;\n    /**心跳定时器id */\n    protected _heartbeatTimeId: number;\n    /**最新心跳超时时间 */\n    protected _nextHeartbeatTimeoutTime: number;\n    /**\n     * 心跳包处理\n     * @param dpkg\n     */\n    protected _heartbeat(dpkg: enet.IDecodePackage) {\n        const heartbeatCfg = this._heartbeatConfig;\n        const protoHandler = this._protoHandler;\n        if (!heartbeatCfg || !heartbeatCfg.heartbeatInterval) {\n            return;\n        }\n        if (this._heartbeatTimeoutId) {\n            return;\n        }\n        this._heartbeatTimeId = setTimeout(() => {\n            this._heartbeatTimeId = undefined;\n            const heartbeatPkg = protoHandler.encodePkg({ type: PackageType.HEARTBEAT }, this._useCrypto);\n            this.send(heartbeatPkg);\n            this._nextHeartbeatTimeoutTime = Date.now() + heartbeatCfg.heartbeatTimeout;\n\n            this._heartbeatTimeoutId = setTimeout(\n                this._heartbeatTimeoutCb.bind(this),\n                heartbeatCfg.heartbeatTimeout\n            ) as any;\n        }, heartbeatCfg.heartbeatInterval) as any;\n    }\n    /**\n     * 心跳超时处理\n     */\n    protected _heartbeatTimeoutCb() {\n        var gap = this._nextHeartbeatTimeoutTime - Date.now();\n        if (gap > this._reConnectCfg) {\n            this._heartbeatTimeoutId = setTimeout(this._heartbeatTimeoutCb.bind(this), gap) as any;\n        } else {\n            console.error(\"server heartbeat timeout\");\n            this.disConnect();\n        }\n    }\n    /**\n     * 数据包处理\n     * @param dpkg\n     */\n    protected _onData(dpkg: enet.IDecodePackage) {\n        if (dpkg.errorMsg) {\n            return;\n        }\n        let reqCfg: enet.IRequestConfig;\n        if (!isNaN(dpkg.reqId) && dpkg.reqId > 0) {\n            //请求\n            const reqId = dpkg.reqId;\n            reqCfg = this._reqCfgMap[reqId];\n            if (!reqCfg) return;\n            reqCfg.decodePkg = dpkg;\n            this._runHandler(reqCfg.resHandler, dpkg);\n        } else {\n            const pushKey = dpkg.key;\n            //推送\n            let handlers = this._pushHandlerMap[pushKey];\n            const onceHandlers = this._oncePushHandlerMap[pushKey];\n            if (!handlers) {\n                handlers = onceHandlers;\n            } else if (onceHandlers) {\n                handlers = handlers.concat(onceHandlers);\n            }\n            delete this._oncePushHandlerMap[pushKey];\n            if (handlers) {\n                for (let i = 0; i < handlers.length; i++) {\n                    this._runHandler(handlers[i], dpkg);\n                }\n            }\n        }\n        const netEventHandler = this._netEventHandler;\n        netEventHandler.onData && netEventHandler.onData(dpkg, this._connectOpt, reqCfg);\n    }\n    /**\n     * 踢下线数据包处理\n     * @param dpkg\n     */\n    protected _onKick(dpkg: enet.IDecodePackage) {\n        this._netEventHandler.onKick && this._netEventHandler.onKick(dpkg, this._connectOpt);\n    }\n    /**\n     * socket状态是否准备好\n     */\n    protected _isSocketReady(): boolean {\n        const socket = this._socket;\n        const socketIsReady = socket && (socket.state === SocketState.CONNECTING || socket.state === SocketState.OPEN);\n        if (this._inited && socketIsReady) {\n            return true;\n        } else {\n            console.error(\n                `${\n                    this._inited\n                        ? socketIsReady\n                            ? \"socket is ready\"\n                            : \"socket is null or unready\"\n                        : \"netNode is unInited\"\n                }`\n            );\n            return false;\n        }\n    }\n    /**\n     * 当socket连接成功\n     * @param event\n     */\n    protected _onSocketConnected(event: any): void {\n        if (this._isReconnecting) {\n            this._stopReconnect();\n        } else {\n            const handler = this._netEventHandler;\n            const connectOpt = this._connectOpt;\n            const protoHandler = this._protoHandler;\n            if (protoHandler && connectOpt.handShakeReq) {\n                const handShakeNetData = protoHandler.encodePkg({\n                    type: PackageType.HANDSHAKE,\n                    data: connectOpt.handShakeReq\n                });\n                this.send(handShakeNetData);\n            } else {\n                connectOpt.connectEnd && connectOpt.connectEnd();\n                handler.onConnectEnd && handler.onConnectEnd(connectOpt);\n            }\n        }\n    }\n    /**\n     * 当socket报错\n     * @param event\n     */\n    protected _onSocketError(event: any): void {\n        const eventHandler = this._netEventHandler;\n        eventHandler.onError && eventHandler.onError(event, this._connectOpt);\n    }\n    /**\n     * 当socket有消息\n     * @param event\n     */\n    protected _onSocketMsg(event: { data: enet.NetData }) {\n        const depackage = this._protoHandler.decodePkg(event.data);\n        const netEventHandler = this._netEventHandler;\n        const pkgTypeHandler = this._pkgTypeHandlers[depackage.type];\n        if (pkgTypeHandler) {\n            pkgTypeHandler(depackage);\n        } else {\n            console.error(`There is no handler of this type:${depackage.type}`);\n        }\n        if (depackage.errorMsg) {\n            netEventHandler.onCustomError && netEventHandler.onCustomError(depackage, this._connectOpt);\n        }\n        //更新心跳超时时间\n        if (this._nextHeartbeatTimeoutTime) {\n            this._nextHeartbeatTimeoutTime = Date.now() + this._heartbeatConfig.heartbeatTimeout;\n        }\n    }\n    /**\n     * 当socket关闭\n     * @param event\n     */\n    protected _onSocketClosed(event: any): void {\n        const netEventHandler = this._netEventHandler;\n        if (this._isReconnecting) {\n            clearTimeout(this._reconnectTimerId);\n            this.reConnect();\n        } else {\n            netEventHandler.onClosed && netEventHandler.onClosed(event, this._connectOpt);\n        }\n    }\n\n    /**\n     * 执行回调，会并接上透传数据\n     * @param handler 回调\n     * @param depackage 解析完成的数据包\n     */\n    protected _runHandler(handler: enet.AnyCallback, depackage: enet.IDecodePackage) {\n        if (typeof handler === \"function\") {\n            handler(depackage);\n        } else if (typeof handler === \"object\") {\n            handler.method &&\n                handler.method.apply(handler.context, handler.args ? [depackage].concat(handler.args) : [depackage]);\n        }\n    }\n    /**\n     * 停止重连\n     * @param isOk 重连是否成功\n     */\n    protected _stopReconnect(isOk = true) {\n        if (this._isReconnecting) {\n            this._isReconnecting = false;\n            clearTimeout(this._reconnectTimerId);\n            this._curReconnectCount = 0;\n            const eventHandler = this._netEventHandler;\n            eventHandler.onReconnectEnd && eventHandler.onReconnectEnd(isOk, this._reConnectCfg, this._connectOpt);\n        }\n    }\n}\nclass DefaultProtoHandler<ProtoKeyType> implements enet.IProtoHandler<ProtoKeyType> {\n    private _heartbeatCfg: enet.IHeartBeatConfig;\n    public get handShakeRes(): any {\n        return undefined;\n    }\n    public get heartbeatConfig(): enet.IHeartBeatConfig {\n        return this._heartbeatCfg;\n    }\n    encodePkg(pkg: enet.IPackage<any>, useCrypto?: boolean): enet.NetData {\n        return JSON.stringify(pkg);\n    }\n    protoKey2Key(protoKey: ProtoKeyType): string {\n        return protoKey as any;\n    }\n    encodeMsg<T>(msg: enet.IMessage<T, ProtoKeyType>, useCrypto?: boolean): enet.NetData {\n        return JSON.stringify({ type: PackageType.DATA, data: msg } as enet.IPackage);\n    }\n    decodePkg(data: enet.NetData): enet.IDecodePackage<any> {\n        const parsedData: enet.IDecodePackage = JSON.parse(data as string);\n        const pkgType = parsedData.type;\n\n        if (parsedData.type === PackageType.DATA) {\n            const msg: enet.IMessage = parsedData.data;\n            return {\n                key: msg && msg.key,\n                type: pkgType,\n                data: msg.data,\n                reqId: parsedData.data && parsedData.data.reqId\n            } as enet.IDecodePackage;\n        } else {\n            if (pkgType === PackageType.HANDSHAKE) {\n                this._heartbeatCfg = parsedData.data;\n            }\n            return {\n                type: pkgType,\n                data: parsedData.data\n            } as enet.IDecodePackage;\n        }\n    }\n}\n"],"names":["PackageType","SocketState"],"mappings":"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"}
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var o=function(){function o(){}return Object.defineProperty(o.prototype,"poolObjs",{get:function(){return this._poolObjs},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sign",{get:function(){return this._sign},enumerable:!1,configurable:!0}),o.prototype.setObjHandler=function(o){o&&(o.pool=this,this._objHandler=o)},Object.defineProperty(o.prototype,"size",{get:function(){var o=this._poolObjs;return o?o.length:0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"usedCount",{get:function(){return this._usedObjMap?this._usedObjMap.size:0},enumerable:!1,configurable:!0}),o.prototype.init=function(o){if(this._sign)this._loghasInit();else{if(!o.sign)return void console.log("[objPool] sign is undefind");if(!o.createFunc&&!o.clas)return void console.error("[objPool] sign:"+o.sign+"  no createFunc and class");this._sign=o.sign,this._poolObjs=[],this._usedObjMap=new Map,this.threshold=o.threshold;var t=o.clas;o.createFunc?this._createFunc=o.createFunc:o.clas&&(this._createFunc=function(){return new t}),this._objHandler=o.objHandler}return this},o.prototype.initByFunc=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=t),this},o.prototype.initByClass=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=function(){return new t}),this},o.prototype.preCreate=function(o){if(this._sign)for(var t,e=this._poolObjs,n=this._objHandler,i=0;i<o;i++)(t=this._createFunc())&&t.onCreate?t.onCreate(this):n&&n.onCreate&&n.onCreate(t),t.poolSign=this._sign,t.isInPool=!0,t.pool=this,e.push(t);else this._logNotInit()},o.prototype.clear=function(){var o=this.poolObjs;if(o){for(var t=void 0,e=0;e<o.length;e++)t=o[e],this.kill(t);o.length=0}},o.prototype.kill=function(o){if(this._usedObjMap.has(o)){var t=this._objHandler;o.onFree||o.onReturn?(o.onFree&&o.onFree(),o.onReturn&&o.onReturn()):t&&(t.onFree||t.onReturn)&&(t.onFree&&t.onFree(o),t.onReturn&&t.onReturn(o)),this._usedObjMap.delete(o)}var e=this._objHandler;o&&o.onKill?o.onKill():e&&e.onKill&&e.onKill(o),o.isInPool=!1,o.pool&&(o.pool=void 0)},o.prototype.free=function(o){this.return(o)},o.prototype.return=function(o){if(this._sign)if(o.isInPool)console.warn("pool :"+this._sign+" obj is in pool");else{var t=this._objHandler;if(this.threshold&&this.size>=this.threshold)return void this.kill(o);o.onFree||o.onReturn?(o.onFree&&o.onFree(),o.onReturn&&o.onReturn()):t&&(t.onFree||t.onReturn)&&(t.onFree&&t.onFree(o),t.onReturn&&t.onReturn(o)),o.isInPool=!0,this._poolObjs.push(o),this._usedObjMap.delete(o)}else this._logNotInit()},o.prototype.returnAll=function(){var o=this;this._usedObjMap.forEach((function(t){o.free(t)})),this._usedObjMap.clear()},o.prototype.freeAll=function(){this.returnAll()},o.prototype.get=function(o){if(this._sign){var t;this.poolObjs.length?t=this._poolObjs.pop():((t=this._createFunc()).onCreate&&t.onCreate(this),t.poolSign=this._sign),this._usedObjMap.set(t,t),t.isInPool=!1;var e=this._objHandler;return t.onGet?t.onGet(o):e&&e.onGet&&e.onGet(t,o),t}this._logNotInit()},o.prototype.getMore=function(o,t){void 0===t&&(t=1);var e=[];if(!isNaN(t)&&t>1)for(var n=0;n<t;n++)e.push(this.get(o));else e.push(this.get(o));return e},o.prototype._loghasInit=function(){console.warn("objpool "+this._sign+" already inited")},o.prototype._logNotInit=function(){console.error("objpool is not init")},o}(),t="objPool is null",e="objPool is exit",n="sign is null",i=function(){function i(){this._poolDic={}}return i.prototype.setPoolThreshold=function(o,e){var n=this._poolDic[o];n?n.threshold=e:this._log(t+":"+o)},i.prototype.setPoolHandler=function(o,e){var n=this._poolDic[o];n?n.setObjHandler(e):this._log(t)},i.prototype.createObjPool=function(t){var i=t.sign;if(this.hasPool(i))this._log(""+e+i);else{if(i&&""!==i.trim()){var r=new o;return(r=r.init(t))&&(this._poolDic[i]=r),r}this._log(""+n)}},i.prototype.createByClass=function(t,i){if(this.hasPool(t))this._log(""+e+t);else if(t&&""!==t.trim()){var r=new o;r.initByClass(t,i),this._poolDic[t]=r}else this._log(""+n)},i.prototype.createByFunc=function(t,i){if(this.hasPool(t))this._log(""+e+t);else if(t&&""!==t.trim()){var r=new o;r.initByFunc(t,i),this._poolDic[t]=r}else this._log(""+n)},i.prototype.hasPool=function(o){return!!this._poolDic[o]},i.prototype.getPool=function(o){return this._poolDic[o]},i.prototype.clearPool=function(o){var t=this._poolDic[o];t&&t.clear()},i.prototype.destroyPool=function(o){var e=this._poolDic,n=e[o];n?(n.clear(),e[o]=void 0):this._log(""+t+o)},i.prototype.preCreate=function(o,e){var n=this._poolDic[o];n?n.preCreate(e):this._log(""+t+o)},i.prototype.get=function(o,t){var e=this._poolDic[o];return e?e.get(t):void 0},i.prototype.getMore=function(o,t,e){var n=this._poolDic[o];return n?n.getMore(t,e):void 0},i.prototype.getPoolObjsBySign=function(o){var t=this._poolDic[o];return t?t.poolObjs:void 0},i.prototype.free=function(o){this.return(o)},i.prototype.return=function(o){var t=this._poolDic[o.poolSign];t&&t.free(o)},i.prototype.freeAll=function(o){this.returnAll(o)},i.prototype.returnAll=function(o){var t=this._poolDic[o];t&&t.returnAll()},i.prototype.kill=function(o){var t=this._poolDic[o.poolSign];t&&t.kill(o)},i.prototype._log=function(o,t){void 0===t&&(t=1);var e="[objPool.ObjPoolMgr]";switch(t){case 0:console.log(e+o);break;case 1:console.warn(e+o);case 2:console.error(e+o);default:console.log(e+o)}},i}();exports.BaseObjPool=o,exports.ObjPoolMgr=i;

var o=function(){function o(){}return Object.defineProperty(o.prototype,"poolObjs",{get:function(){return this._poolObjs},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sign",{get:function(){return this._sign},enumerable:!1,configurable:!0}),o.prototype.setObjHandler=function(o){o&&(o.pool=this,this._objHandler=o)},Object.defineProperty(o.prototype,"size",{get:function(){var o=this._poolObjs;return o?o.length:0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"usedCount",{get:function(){return this._usedObjMap?this._usedObjMap.size:0},enumerable:!1,configurable:!0}),o.prototype.init=function(o){if(this._sign)this._loghasInit();else{if(!o.sign)return void console.log("[objPool] sign is undefind");if(!o.createFunc&&!o.clas)return void console.error("[objPool] sign:"+o.sign+"  no createFunc and class");this._sign=o.sign,this._poolObjs=[],this._usedObjMap=new Map,this.threshold=o.threshold;var t=o.clas;o.createFunc?this._createFunc=o.createFunc:o.clas&&(this._createFunc=function(){return new t}),this._objHandler=o.objHandler}return this},o.prototype.initByFunc=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=t),this},o.prototype.initByClass=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=function(){return new t}),this},o.prototype.preCreate=function(o){if(this._sign)for(var t,e=this._poolObjs,i=this._objHandler,n=0;n<o;n++)(t=this._createFunc())&&t.onCreate?t.onCreate():i&&i.onCreate&&i.onCreate(t),t.poolSign=this._sign,t.isInPool=!0,t.pool=this,e.push(t);else this._logNotInit()},o.prototype.clear=function(){var o=this.poolObjs;if(o){for(var t=void 0,e=0;e<o.length;e++)t=o[e],this.kill(t);o.length=0}},o.prototype.kill=function(o){if(this._usedObjMap.has(o)){var t=this._objHandler;o.onReturn?o.onReturn&&o.onReturn():t&&t.onReturn&&t.onReturn&&t.onReturn(o),this._usedObjMap.delete(o)}var e=this._objHandler;o&&o.onKill?o.onKill():e&&e.onKill&&e.onKill(o),o.isInPool=!1,o.pool&&(o.pool=void 0)},o.prototype.return=function(o){if(this._sign)if(o.isInPool)console.warn("pool :"+this._sign+" obj is in pool");else{o.isInPool=!0;var t=this._objHandler;if(this.threshold&&this.size>=this.threshold)return void this.kill(o);o.onReturn?o.onReturn&&o.onReturn():t&&t.onReturn&&t.onReturn&&t.onReturn(o),this._poolObjs.push(o),this._usedObjMap.delete(o)}else this._logNotInit()},o.prototype.returnAll=function(){var o=this;this._usedObjMap.forEach((function(t){o.return(t)})),this._usedObjMap.clear()},o.prototype.get=function(o){if(this._sign){var t,e=this._objHandler;return this.poolObjs.length?t=this._poolObjs.pop():((t=this._createFunc())&&t.onCreate?t.onCreate():e&&e.onCreate&&e.onCreate(t),t.poolSign=this._sign,t.pool=this),this._usedObjMap.set(t,t),t.isInPool=!1,t.onGet?t.onGet(o):e&&e.onGet&&e.onGet(t,o),t}this._logNotInit()},o.prototype.getMore=function(o,t){void 0===t&&(t=1);var e=[];if(!isNaN(t)&&t>1)for(var i=0;i<t;i++)e.push(this.get(o));else e.push(this.get(o));return e},o.prototype._loghasInit=function(){console.warn("objpool "+this._sign+" already inited")},o.prototype._logNotInit=function(){console.error("objpool is not init")},o}(),t="objPool is null",e="objPool is exit",i="sign is null",n=function(){function n(){this._poolDic={}}return n.prototype.setPoolThreshold=function(o,e){var i=this._poolDic[o];i?i.threshold=e:this._log(t+":"+o)},n.prototype.setPoolHandler=function(o,e){var i=this._poolDic[o];i?i.setObjHandler(e):this._log(t)},n.prototype.createObjPool=function(t){var n=t.sign;if(this.hasPool(n))this._log(""+e+n);else{if(n&&""!==n.trim()){var r=new o;return(r=r.init(t))&&(this._poolDic[n]=r),r}this._log(""+i)}},n.prototype.createByClass=function(t,n){if(this.hasPool(t))this._log(""+e+t);else if(t&&""!==t.trim()){var r=new o;r.initByClass(t,n),this._poolDic[t]=r}else this._log(""+i)},n.prototype.createByFunc=function(t,n){if(this.hasPool(t))this._log(""+e+t);else if(t&&""!==t.trim()){var r=new o;r.initByFunc(t,n),this._poolDic[t]=r}else this._log(""+i)},n.prototype.hasPool=function(o){return!!this._poolDic[o]},n.prototype.getPool=function(o){return this._poolDic[o]},n.prototype.clearPool=function(o){var t=this._poolDic[o];t&&t.clear()},n.prototype.destroyPool=function(o){var e=this._poolDic,i=e[o];i?(i.clear(),e[o]=void 0):this._log(""+t+o)},n.prototype.preCreate=function(o,e){var i=this._poolDic[o];i?i.preCreate(e):this._log(""+t+o)},n.prototype.get=function(o,t){var e=this._poolDic[o];return e?e.get(t):void 0},n.prototype.getMore=function(o,t,e){var i=this._poolDic[o];return i?i.getMore(t,e):void 0},n.prototype.getPoolObjsBySign=function(o){var t=this._poolDic[o];return t?t.poolObjs:void 0},n.prototype.return=function(o){var t=this._poolDic[o.poolSign];t&&t.return(o)},n.prototype.returnAll=function(o){var t=this._poolDic[o];t&&t.returnAll()},n.prototype.kill=function(o){var t=this._poolDic[o.poolSign];t&&t.kill(o)},n.prototype._log=function(o,t){void 0===t&&(t=1);var e="[objPool.ObjPoolMgr]";switch(t){case 0:console.log(e+o);break;case 1:console.warn(e+o);case 2:console.error(e+o);default:console.log(e+o)}},n}();export{o as BaseObjPool,n as ObjPoolMgr};

!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((o="undefined"!=typeof globalThis?globalThis:o||self).objPool={})}(this,(function(o){"use strict";var t=function(){function o(){}return Object.defineProperty(o.prototype,"poolObjs",{get:function(){return this._poolObjs},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sign",{get:function(){return this._sign},enumerable:!1,configurable:!0}),o.prototype.setObjHandler=function(o){o&&(o.pool=this,this._objHandler=o)},Object.defineProperty(o.prototype,"size",{get:function(){var o=this._poolObjs;return o?o.length:0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"usedCount",{get:function(){return this._usedObjMap?this._usedObjMap.size:0},enumerable:!1,configurable:!0}),o.prototype.init=function(o){if(this._sign)this._loghasInit();else{if(!o.sign)return void console.log("[objPool] sign is undefind");if(!o.createFunc&&!o.clas)return void console.error("[objPool] sign:"+o.sign+"  no createFunc and class");this._sign=o.sign,this._poolObjs=[],this._usedObjMap=new Map,this.threshold=o.threshold;var t=o.clas;o.createFunc?this._createFunc=o.createFunc:o.clas&&(this._createFunc=function(){return new t}),this._objHandler=o.objHandler}return this},o.prototype.initByFunc=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=t),this},o.prototype.initByClass=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=function(){return new t}),this},o.prototype.preCreate=function(o){if(this._sign)for(var t,e=this._poolObjs,i=this._objHandler,n=0;n<o;n++)(t=this._createFunc())&&t.onCreate?t.onCreate():i&&i.onCreate&&i.onCreate(t),t.poolSign=this._sign,t.isInPool=!0,t.pool=this,e.push(t);else this._logNotInit()},o.prototype.clear=function(){var o=this.poolObjs;if(o){for(var t=void 0,e=0;e<o.length;e++)t=o[e],this.kill(t);o.length=0}},o.prototype.kill=function(o){if(this._usedObjMap.has(o)){var t=this._objHandler;o.onReturn?o.onReturn&&o.onReturn():t&&t.onReturn&&t.onReturn&&t.onReturn(o),this._usedObjMap.delete(o)}var e=this._objHandler;o&&o.onKill?o.onKill():e&&e.onKill&&e.onKill(o),o.isInPool=!1,o.pool&&(o.pool=void 0)},o.prototype.return=function(o){if(this._sign)if(o.isInPool)console.warn("pool :"+this._sign+" obj is in pool");else{var t=this._objHandler;if(this.threshold&&this.size>=this.threshold)return void this.kill(o);o.onReturn?o.onReturn&&o.onReturn():t&&t.onReturn&&t.onReturn&&t.onReturn(o),o.isInPool=!0,this._poolObjs.push(o),this._usedObjMap.delete(o)}else this._logNotInit()},o.prototype.returnAll=function(){var o=this;this._usedObjMap.forEach((function(t){o.return(t)})),this._usedObjMap.clear()},o.prototype.get=function(o){if(this._sign){var t;this.poolObjs.length?t=this._poolObjs.pop():((t=this._createFunc()).onCreate&&t.onCreate(),t.poolSign=this._sign),this._usedObjMap.set(t,t),t.isInPool=!1;var e=this._objHandler;return t.onGet?t.onGet(o):e&&e.onGet&&e.onGet(t,o),t}this._logNotInit()},o.prototype.getMore=function(o,t){void 0===t&&(t=1);var e=[];if(!isNaN(t)&&t>1)for(var i=0;i<t;i++)e.push(this.get(o));else e.push(this.get(o));return e},o.prototype._loghasInit=function(){console.warn("objpool "+this._sign+" already inited")},o.prototype._logNotInit=function(){console.error("objpool is not init")},o}(),e="objPool is null",i="objPool is exit",n="sign is null",r=function(){function o(){this._poolDic={}}return o.prototype.setPoolThreshold=function(o,t){var i=this._poolDic[o];i?i.threshold=t:this._log(e+":"+o)},o.prototype.setPoolHandler=function(o,t){var i=this._poolDic[o];i?i.setObjHandler(t):this._log(e)},o.prototype.createObjPool=function(o){var e=o.sign;if(this.hasPool(e))this._log(""+i+e);else{if(e&&""!==e.trim()){var r=new t;return(r=r.init(o))&&(this._poolDic[e]=r),r}this._log(""+n)}},o.prototype.createByClass=function(o,e){if(this.hasPool(o))this._log(""+i+o);else if(o&&""!==o.trim()){var r=new t;r.initByClass(o,e),this._poolDic[o]=r}else this._log(""+n)},o.prototype.createByFunc=function(o,e){if(this.hasPool(o))this._log(""+i+o);else if(o&&""!==o.trim()){var r=new t;r.initByFunc(o,e),this._poolDic[o]=r}else this._log(""+n)},o.prototype.hasPool=function(o){return!!this._poolDic[o]},o.prototype.getPool=function(o){return this._poolDic[o]},o.prototype.clearPool=function(o){var t=this._poolDic[o];t&&t.clear()},o.prototype.destroyPool=function(o){var t=this._poolDic,i=t[o];i?(i.clear(),t[o]=void 0):this._log(""+e+o)},o.prototype.preCreate=function(o,t){var i=this._poolDic[o];i?i.preCreate(t):this._log(""+e+o)},o.prototype.get=function(o,t){var e=this._poolDic[o];return e?e.get(t):void 0},o.prototype.getMore=function(o,t,e){var i=this._poolDic[o];return i?i.getMore(t,e):void 0},o.prototype.getPoolObjsBySign=function(o){var t=this._poolDic[o];return t?t.poolObjs:void 0},o.prototype.return=function(o){var t=this._poolDic[o.poolSign];t&&t.return(o)},o.prototype.returnAll=function(o){var t=this._poolDic[o];t&&t.returnAll()},o.prototype.kill=function(o){var t=this._poolDic[o.poolSign];t&&t.kill(o)},o.prototype._log=function(o,t){void 0===t&&(t=1);var e="[objPool.ObjPoolMgr]";switch(t){case 0:console.log(e+o);break;case 1:console.warn(e+o);case 2:console.error(e+o);default:console.log(e+o)}},o}();o.BaseObjPool=t,o.ObjPoolMgr=r,Object.defineProperty(o,"__esModule",{value:!0})}));var globalTarget=window||global;globalTarget.objPool?Object.assign({},globalTarget.objPool):globalTarget.objPool=objPool;

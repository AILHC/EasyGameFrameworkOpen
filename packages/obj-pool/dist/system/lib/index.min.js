System.register("@ailhc/obj-pool",[],(function(o){"use strict";return{execute:function(){var t=o("BaseObjPool",function(){function o(){}return Object.defineProperty(o.prototype,"poolObjs",{get:function(){return this._poolObjs},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"sign",{get:function(){return this._sign},enumerable:!1,configurable:!0}),o.prototype.setObjHandler=function(o){o&&(o.pool=this,this._objHandler=o)},Object.defineProperty(o.prototype,"size",{get:function(){var o=this._poolObjs;return o?o.length:0},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"usedCount",{get:function(){return this._usedObjMap?this._usedObjMap.size:0},enumerable:!1,configurable:!0}),o.prototype.init=function(o){if(this._sign)this._loghasInit();else{if(!o.sign)return void console.log("[objPool] sign is undefind");if(!o.createFunc&&!o.clas)return void console.error("[objPool] sign:"+o.sign+"  no createFunc and class");this._sign=o.sign,this._poolObjs=[],this._usedObjMap=new Map,this.threshold=o.threshold;var t=o.clas;o.createFunc?this._createFunc=o.createFunc:o.clas&&(this._createFunc=function(){return new t}),this._objHandler=o.objHandler}return this},o.prototype.initByFunc=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=t),this},o.prototype.initByClass=function(o,t){return this._sign?this._loghasInit():(this._sign=o,this._poolObjs=[],this._usedObjMap=new Map,this._createFunc=function(){return new t}),this},o.prototype.preCreate=function(o){if(this._sign)for(var t,e=this._poolObjs,n=this._objHandler,i=0;i<o;i++)(t=this._createFunc())&&t.onCreate?t.onCreate(this):n&&n.onCreate&&n.onCreate(t),t.poolSign=this._sign,t.isInPool=!0,t.pool=this,e.push(t);else this._logNotInit()},o.prototype.clear=function(){var o=this.poolObjs;if(o){for(var t=void 0,e=0;e<o.length;e++)t=o[e],this.kill(t);o.length=0}},o.prototype.kill=function(o){if(this._usedObjMap.has(o)){var t=this._objHandler;o.onFree||o.onReturn?(o.onFree&&o.onFree(),o.onReturn&&o.onReturn()):t&&(t.onFree||t.onReturn)&&(t.onFree&&t.onFree(o),t.onReturn&&t.onReturn(o)),this._usedObjMap.delete(o)}var e=this._objHandler;o&&o.onKill?o.onKill():e&&e.onKill&&e.onKill(o),o.isInPool=!1,o.pool&&(o.pool=void 0)},o.prototype.free=function(o){this.return(o)},o.prototype.return=function(o){if(this._sign)if(o.isInPool)console.warn("pool :"+this._sign+" obj is in pool");else{var t=this._objHandler;if(this.threshold&&this.size>=this.threshold)return void this.kill(o);o.onFree||o.onReturn?(o.onFree&&o.onFree(),o.onReturn&&o.onReturn()):t&&(t.onFree||t.onReturn)&&(t.onFree&&t.onFree(o),t.onReturn&&t.onReturn(o)),o.isInPool=!0,this._poolObjs.push(o),this._usedObjMap.delete(o)}else this._logNotInit()},o.prototype.returnAll=function(){var o=this;this._usedObjMap.forEach((function(t){o.free(t)})),this._usedObjMap.clear()},o.prototype.freeAll=function(){this.returnAll()},o.prototype.get=function(o){if(this._sign){var t;this.poolObjs.length?t=this._poolObjs.pop():((t=this._createFunc()).onCreate&&t.onCreate(this),t.poolSign=this._sign),this._usedObjMap.set(t,t),t.isInPool=!1;var e=this._objHandler;return t.onGet?t.onGet(o):e&&e.onGet&&e.onGet(t,o),t}this._logNotInit()},o.prototype.getMore=function(o,t){void 0===t&&(t=1);var e=[];if(!isNaN(t)&&t>1)for(var n=0;n<t;n++)e.push(this.get(o));else e.push(this.get(o));return e},o.prototype._loghasInit=function(){console.warn("objpool "+this._sign+" already inited")},o.prototype._logNotInit=function(){console.error("objpool is not init")},o}()),e="objPool is null",n="objPool is exit",i="sign is null";o("ObjPoolMgr",function(){function o(){this._poolDic={}}return o.prototype.setPoolThreshold=function(o,t){var n=this._poolDic[o];n?n.threshold=t:this._log(e+":"+o)},o.prototype.setPoolHandler=function(o,t){var n=this._poolDic[o];n?n.setObjHandler(t):this._log(e)},o.prototype.createObjPool=function(o){var e=o.sign;if(this.hasPool(e))this._log(""+n+e);else{if(e&&""!==e.trim()){var r=new t;return(r=r.init(o))&&(this._poolDic[e]=r),r}this._log(""+i)}},o.prototype.createByClass=function(o,e){if(this.hasPool(o))this._log(""+n+o);else if(o&&""!==o.trim()){var r=new t;r.initByClass(o,e),this._poolDic[o]=r}else this._log(""+i)},o.prototype.createByFunc=function(o,e){if(this.hasPool(o))this._log(""+n+o);else if(o&&""!==o.trim()){var r=new t;r.initByFunc(o,e),this._poolDic[o]=r}else this._log(""+i)},o.prototype.hasPool=function(o){return!!this._poolDic[o]},o.prototype.getPool=function(o){return this._poolDic[o]},o.prototype.clearPool=function(o){var t=this._poolDic[o];t&&t.clear()},o.prototype.destroyPool=function(o){var t=this._poolDic,n=t[o];n?(n.clear(),t[o]=void 0):this._log(""+e+o)},o.prototype.preCreate=function(o,t){var n=this._poolDic[o];n?n.preCreate(t):this._log(""+e+o)},o.prototype.get=function(o,t){var e=this._poolDic[o];return e?e.get(t):void 0},o.prototype.getMore=function(o,t,e){var n=this._poolDic[o];return n?n.getMore(t,e):void 0},o.prototype.getPoolObjsBySign=function(o){var t=this._poolDic[o];return t?t.poolObjs:void 0},o.prototype.free=function(o){this.return(o)},o.prototype.return=function(o){var t=this._poolDic[o.poolSign];t&&t.free(o)},o.prototype.freeAll=function(o){this.returnAll(o)},o.prototype.returnAll=function(o){var t=this._poolDic[o];t&&t.returnAll()},o.prototype.kill=function(o){var t=this._poolDic[o.poolSign];t&&t.kill(o)},o.prototype._log=function(o,t){void 0===t&&(t=1);var e="[objPool.ObjPoolMgr]";switch(t){case 0:console.log(e+o);break;case 1:console.warn(e+o);case 2:console.error(e+o);default:console.log(e+o)}},o}())}}}));

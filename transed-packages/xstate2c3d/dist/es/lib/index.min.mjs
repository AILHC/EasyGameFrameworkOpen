/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(){return(t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function e(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function n(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function i(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t}var o={},a="production"===process.env.NODE_ENV;function s(t){return Object.keys(t)}function c(t,e,n){void 0===n&&(n=".");var r=f(t,n),i=f(e,n);return T(i)?!!T(r)&&i===r:T(r)?r in i:s(r).every((function(t){return t in i&&c(r[t],i[t])}))}function u(t){try{return T(t)||"number"==typeof t?""+t:t.type}catch(t){throw new Error("Events must be strings or objects with a string event.type property.")}}function h(t,e){try{return N(t)?t:t.toString().split(e)}catch(e){throw new Error("'"+t+"' is not a valid state path.")}}function f(t,e){return"object"==typeof(n=t)&&"value"in n&&"context"in n&&"event"in n&&"_event"in n?t.value:N(t)?l(t):"string"!=typeof t?t:l(h(t,e));var n}function l(t){if(1===t.length)return t[0];for(var e={},n=e,r=0;r<t.length-1;r++)r===t.length-2?n[t[r]]=t[r+1]:(n[t[r]]={},n=n[t[r]]);return e}function d(t,e){for(var n={},r=s(t),i=0;i<r.length;i++){var o=r[i];n[o]=e(t[o],o,t,i)}return n}function v(t,e,r){var i,o,a={};try{for(var c=n(s(t)),u=c.next();!u.done;u=c.next()){var h=u.value,f=t[h];r(f)&&(a[h]=e(f,h,t))}}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}return a}var p=function(t){return function(e){var r,i,o=e;try{for(var a=n(t),s=a.next();!s.done;s=a.next()){o=o[s.value]}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return o}};function y(t){return t?T(t)?[[t]]:g(s(t).map((function(e){var n=t[e];return"string"==typeof n||n&&Object.keys(n).length?y(t[e]).map((function(t){return[e].concat(t)})):[[e]]}))):[[]]}function g(t){var e;return(e=[]).concat.apply(e,i(t))}function m(t){return N(t)?t:[t]}function x(t){return void 0===t?[]:m(t)}function w(t,e,r){var i,o;if(O(t))return t(e,r.data);var a={};try{for(var s=n(Object.keys(t)),c=s.next();!c.done;c=s.next()){var u=c.value,h=t[u];O(h)?a[u]=h(e,r.data):a[u]=h}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}return a}function S(t){return t instanceof Promise||!(null===t||!O(t)&&"object"!=typeof t||!O(t.then))}function b(t,e){var i,o,a=r([[],[]],2),s=a[0],c=a[1];try{for(var u=n(t),h=u.next();!h.done;h=u.next()){var f=h.value;e(f)?s.push(f):c.push(f)}}catch(t){i={error:t}}finally{try{h&&!h.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return[s,c]}function _(t,e){return d(t.states,(function(t,n){if(t){var r=(T(e)?void 0:e[n])||(t?t.current:void 0);if(r)return{current:r,states:_(t,r)}}}))}var E=function(){};function N(t){return Array.isArray(t)}function O(t){return"function"==typeof t}function T(t){return"string"==typeof t}function k(t,e){if(t)return T(t)?{type:"xstate.guard",name:t,predicate:e?e[t]:void 0}:O(t)?{type:"xstate.guard",name:t.name,predicate:t}:t}function P(t){try{return"subscribe"in t&&O(t.subscribe)}catch(t){return!1}}a||(E=function(t,e){var n=t instanceof Error?t:void 0;if((n||!t)&&void 0!==console){var r=["Warning: "+e];n&&r.push(n),console.warn.apply(console,r)}});var C=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function j(t){try{return"__xstatenode"in t}catch(t){return!1}}var V,D,I=function(){var t=0;return function(){return(++t).toString(16)}}();function L(e,n){return T(e)||"number"==typeof e?t({type:e},n):e}function A(e,n){if(!T(e)&&"$$type"in e&&"scxml"===e.$$type)return e;var r=L(e);return t({name:r.type,data:r,$$type:"scxml",type:"external"},n)}function M(e,n){return m(n).map((function(n){return void 0===n||"string"==typeof n||j(n)?{target:n,event:e}:t(t({},n),{event:e})}))}function R(t,e,n,r,i){var o=t.options.guards,a={state:i,cond:e,_event:r};if("xstate.guard"===e.type)return e.predicate(n,r.data,a);var s=o[e.type];if(!s)throw new Error("Guard '"+e.type+"' is not implemented on machine '"+t.id+"'.");return s(n,r.data,a)}function z(t){return"string"==typeof t?{type:t}:t}function F(t,e){var r,i,o;try{for(var a=n(s(t)),u=a.next();!u.done;u=a.next()){var h=u.value;c(h,e)&&(!o||e.length>o.length)&&(o=h)}}catch(t){r={error:t}}finally{try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}return t[o]}!function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"}(V||(V={})),function(t){t.Parent="#_parent",t.Internal="#_internal"}(D||(D={}));var J=V.Start,U=V.Stop,B=V.Raise,q=V.Send,$=V.Cancel,X=V.NullEvent,H=V.Assign,G=(V.After,V.DoneState,V.Log),W=V.Init,K=V.Invoke,Q=(V.ErrorExecution,V.ErrorPlatform),Y=V.ErrorCustom,Z=V.Update,tt=V.Choose,et=V.Pure,nt=A({type:W});function rt(t,e){return e&&e[t]||void 0}function it(e,n){var r;if(T(e)||"number"==typeof e){var i=rt(e,n);r=O(i)?{type:e,exec:i}:i||{type:e,exec:void 0}}else if(O(e))r={type:e.name||e.toString(),exec:e};else{if(O(i=rt(e.type,n)))r=t(t({},e),{exec:i});else if(i){var o=i.type||e.type;r=t(t(t({},i),e),{type:o})}else r=e}return Object.defineProperty(r,"toString",{value:function(){return r.type},enumerable:!1,configurable:!0}),r}var ot=function(t,e){return t?(N(t)?t:[t]).map((function(t){return it(t,e)})):[]};function at(e){var n=it(e);return t(t({id:T(e)?e:n.id},n),{type:n.type})}function st(t){return T(t)?{type:B,event:t}:ct(t,{to:D.Internal})}function ct(t,e){return{to:e?e.to:void 0,type:q,event:O(t)?t:L(t),delay:e?e.delay:void 0,id:e&&void 0!==e.id?e.id:O(t)?t.name:u(t)}}function ut(e,n){return ct(e,t(t({},n),{to:D.Parent}))}function ht(){return ut(Z)}var ft=function(t,e){return{context:t,event:e}};var lt=function(t){return{type:$,sendId:t}};function dt(t){var e=at(t);return{type:V.Start,activity:e,exec:void 0}}function vt(t){var e=O(t)?t:at(t);return{type:V.Stop,activity:e,exec:void 0}}var pt=function(t){return{type:H,assignment:t}};function yt(t,e){var n=e?"#"+e:"";return V.After+"("+t+")"+n}function gt(t,e){var n=V.DoneState+"."+t,r={type:n,data:e,toString:function(){return n}};return r}function mt(t,e){var n=V.DoneInvoke+"."+t,r={type:n,data:e,toString:function(){return n}};return r}function xt(t,e){var n=V.ErrorPlatform+"."+t,r={type:n,data:e,toString:function(){return n}};return r}function wt(e,n){return ct((function(t,e){return e}),t(t({},n),{to:e}))}function St(e,i,o,c,u){var h=r(b(u,(function(t){return t.type===H})),2),f=h[0],l=h[1],d=f.length?function(t,e,r,i){return a||E(!!t,"Attempting to update undefined context"),t?r.reduce((function(t,r){var o,a,c=r.assignment,u={state:i,action:r,_event:e},h={};if(O(c))h=c(t,e.data,u);else try{for(var f=n(s(c)),l=f.next();!l.done;l=f.next()){var d=l.value,v=c[d];h[d]=O(v)?v(t,e.data,u):v}}catch(t){o={error:t}}finally{try{l&&!l.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}return Object.assign({},t,h)}),t):t}(o,c,f,i):o;return[g(l.map((function(n){var r;switch(n.type){case B:return{type:B,_event:A(n.event)};case q:var o=function(e,n,r,i){var o,a={_event:r},s=A(O(e.event)?e.event(n,r.data,a):e.event);if(T(e.delay)){var c=i&&i[e.delay];o=O(c)?c(n,r.data,a):c}else o=O(e.delay)?e.delay(n,r.data,a):e.delay;var u=O(e.to)?e.to(n,r.data,a):e.to;return t(t({},e),{to:u,_event:s,event:s.data,delay:o})}(n,d,c,e.options.delays);return a||E(!T(n.delay)||"number"==typeof o.delay,"No delay reference for delay expression '"+n.delay+"' was found on machine '"+e.id+"'"),o;case G:return function(e,n,r){return t(t({},e),{value:T(e.expr)?e.expr:e.expr(n,r.data,{_event:r})})}(n,d,c);case tt:if(!(u=null===(r=n.conds.find((function(t){var n=k(t.cond,e.options.guards);return!n||R(e,n,d,c,i)})))||void 0===r?void 0:r.actions))return[];var s=St(e,i,d,c,ot(x(u),e.options.actions));return d=s[1],s[0];case et:var u;if(!(u=n.get(d,c.data)))return[];s=St(e,i,d,c,ot(x(u),e.options.actions));return d=s[1],s[0];case U:return function(t,e,n){var r=O(t.activity)?t.activity(e,n.data):t.activity,i="string"==typeof r?{id:r}:r;return{type:V.Stop,activity:i}}(n,d,c);default:return it(n,e.options.actions)}}))),d]}var bt=function(t){return"atomic"===t.type||"final"===t.type};function _t(t){return s(t.states).map((function(e){return t.states[e]}))}function Et(t){var e=[t];return bt(t)?e:e.concat(g(_t(t).map(Et)))}function Nt(t,e){var r,i,o,a,s,c,u,h,f=Tt(new Set(t)),l=new Set(e);try{for(var d=n(l),v=d.next();!v.done;v=d.next())for(var p=(E=v.value).parent;p&&!l.has(p);)l.add(p),p=p.parent}catch(t){r={error:t}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}var y=Tt(l);try{for(var g=n(l),m=g.next();!m.done;m=g.next()){if("compound"!==(E=m.value).type||y.get(E)&&y.get(E).length){if("parallel"===E.type)try{for(var x=(s=void 0,n(_t(E))),w=x.next();!w.done;w=x.next()){var S=w.value;"history"!==S.type&&(l.has(S)||(l.add(S),f.get(S)?f.get(S).forEach((function(t){return l.add(t)})):S.initialStateNodes.forEach((function(t){return l.add(t)}))))}}catch(t){s={error:t}}finally{try{w&&!w.done&&(c=x.return)&&c.call(x)}finally{if(s)throw s.error}}}else f.get(E)?f.get(E).forEach((function(t){return l.add(t)})):E.initialStateNodes.forEach((function(t){return l.add(t)}))}}catch(t){o={error:t}}finally{try{m&&!m.done&&(a=g.return)&&a.call(g)}finally{if(o)throw o.error}}try{for(var b=n(l),_=b.next();!_.done;_=b.next()){var E;for(p=(E=_.value).parent;p&&!l.has(p);)l.add(p),p=p.parent}}catch(t){u={error:t}}finally{try{_&&!_.done&&(h=b.return)&&h.call(b)}finally{if(u)throw u.error}}return l}function Ot(t,e){var n=e.get(t);if(!n)return{};if("compound"===t.type){var r=n[0];if(!r)return{};if(bt(r))return r.key}var i={};return n.forEach((function(t){i[t.key]=Ot(t,e)})),i}function Tt(t){var e,r,i=new Map;try{for(var o=n(t),a=o.next();!a.done;a=o.next()){var s=a.value;i.has(s)||i.set(s,[]),s.parent&&(i.has(s.parent)||i.set(s.parent,[]),i.get(s.parent).push(s))}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return i}function kt(t,e){return Ot(t,Tt(Nt([t],e)))}function Pt(t,e){return Array.isArray(t)?t.some((function(t){return t===e})):t instanceof Set&&t.has(e)}function Ct(t,e){return"compound"===e.type?_t(e).some((function(e){return"final"===e.type&&Pt(t,e)})):"parallel"===e.type&&_t(e).every((function(e){return Ct(t,e)}))}function jt(t,e){if(t===e)return!0;if(void 0===t||void 0===e)return!1;if(T(t)||T(e))return t===e;var n=s(t),r=s(e);return n.length===r.length&&n.every((function(n){return jt(t[n],e[n])}))}var Vt=function(){function t(t){var e=this;this.actions=[],this.activities=o,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||o,this.meta=t.meta||{},this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,Object.defineProperty(this,"nextEvents",{get:function(){return t=e.configuration,g(i(new Set(t.map((function(t){return t.ownEvents})))));var t}})}return t.from=function(e,n){return e instanceof t?e.context!==n?new t({value:e.value,context:n,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e:new t({value:e,context:n,_event:nt,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,n){if(e instanceof t){if(!e.actions.length)return e;var r=nt;return new t({value:e.value,context:n,_event:r,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,n)},t.prototype.toStrings=function(t,e){var n=this;if(void 0===t&&(t=this.value),void 0===e&&(e="."),T(t))return[t];var r=s(t);return r.concat.apply(r,i(r.map((function(r){return n.toStrings(t[r],e).map((function(t){return r+e+t}))}))))},t.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;return e(t,["configuration","transitions"])},t.prototype.matches=function(t){return c(t,this.value)},t}(),Dt=[],It=function(t,e){Dt.push(t);var n=e(t);return Dt.pop(),n};function Lt(t){return{id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},toJSON:function(){return{id:t}}}}function At(t,e,n){var r=Lt(e);return r.deferred=!0,j(t)&&(r.state=It(void 0,(function(){return(n?t.withContext(n):t).initialState}))),r}function Mt(t){if("string"==typeof t){var e={type:t,toString:function(){return t}};return e}return t}function Rt(n){return t(t({type:K},n),{toJSON:function(){n.onDone,n.onError;var r=e(n,["onDone","onError"]);return t(t({},r),{type:K,src:Mt(n.src)})}})}var zt={},Ft=function(t){return"#"===t[0]},Jt=function(){function o(e,r,c){var u=this;this.config=e,this.context=c,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.options=Object.assign({actions:{},guards:{},services:{},activities:{},delays:{}},r),this.parent=this.options._parent,this.key=this.config.key||this.options._key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:"."),this.id=this.config.id||i([this.machine.key],this.path).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&s(this.config.states).length?"compound":this.config.history?"history":"atomic"),a||E(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '+(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '"+this.type+"'`")+" in the config for state node '"+this.id+"' instead."),this.initial=this.config.initial,this.states=this.config.states?d(this.config.states,(function(e,n){var r,i=new o(e,{_parent:u,_key:n});return Object.assign(u.idMap,t(((r={})[i.id]=i,r),i.idMap)),i})):zt;var h=0;!function t(e){var r,i;e.order=h++;try{for(var o=n(_t(e)),a=o.next();!a.done;a=o.next()){t(a.value)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}}(this),this.history=!0===this.config.history?"shallow":this.config.history||!1,this._transient=!!this.config.always||!!this.config.on&&(Array.isArray(this.config.on)?this.config.on.some((function(t){return""===t.event})):""in this.config.on),this.strict=!!this.config.strict,this.onEntry=x(this.config.entry||this.config.onEntry).map((function(t){return it(t)})),this.onExit=x(this.config.exit||this.config.onExit).map((function(t){return it(t)})),this.meta=this.config.meta,this.doneData="final"===this.type?this.config.data:void 0,this.invoke=x(this.config.invoke).map((function(e,n){var r,i;if(j(e))return u.machine.options.services=t(((r={})[e.id]=e,r),u.machine.options.services),Rt({src:e.id,id:e.id});if(T(e.src))return Rt(t(t({},e),{id:e.id||e.src,src:e.src}));if(j(e.src)||O(e.src)){var o=u.id+":invocation["+n+"]";return u.machine.options.services=t(((i={})[o]=e.src,i),u.machine.options.services),Rt(t(t({id:o},e),{src:o}))}var a=e.src;return Rt(t(t({id:a.type},e),{src:a}))})),this.activities=x(this.config.activities).concat(this.invoke).map((function(t){return at(t)})),this.transition=this.transition.bind(this)}return o.prototype._init=function(){this.__cache.transitions||Et(this).forEach((function(t){return t.on}))},o.prototype.withConfig=function(e,n){void 0===n&&(n=this.context);var r=this.options,i=r.actions,a=r.activities,s=r.guards,c=r.services,u=r.delays;return new o(this.config,{actions:t(t({},i),e.actions),activities:t(t({},a),e.activities),guards:t(t({},s),e.guards),services:t(t({},c),e.services),delays:t(t({},u),e.delays)},n)},o.prototype.withContext=function(t){return new o(this.config,this.options,t)},Object.defineProperty(o.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:d(this.states,(function(t){return t.definition})),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke}},enumerable:!1,configurable:!0}),o.prototype.toJSON=function(){return this.definition},Object.defineProperty(o.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce((function(t,e){return t[e.eventType]=t[e.eventType]||[],t[e.eventType].push(e),t}),{})},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),o.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var e=""===t,n=this.transitions.filter((function(n){var r=n.eventType===t;return e?r:r||"*"===n.eventType}));return this.__cache.candidates[t]=n,n},o.prototype.getDelayedTransitions=function(){var e=this,n=this.config.after;if(!n)return[];var r=function(t,n){var r=yt(O(t)?e.id+":delay["+n+"]":t,e.id);return e.onEntry.push(ct(r,{delay:t})),e.onExit.push(lt(r)),r};return(N(n)?n.map((function(e,n){var i=r(e.delay,n);return t(t({},e),{event:i})})):g(s(n).map((function(e,i){var o=n[e],a=T(o)?{target:o}:o,s=isNaN(+e)?e:+e,c=r(s,i);return x(a).map((function(e){return t(t({},e),{event:c,delay:s})}))})))).map((function(n){var r=n.delay;return t(t({},e.formatTransition(n)),{delay:r})}))},o.prototype.getStateNodes=function(t){var e,n=this;if(!t)return[];var r=t instanceof Vt?t.value:f(t,this.delimiter);if(T(r)){var i=this.getStateNode(r).initial;return void 0!==i?this.getStateNodes(((e={})[r]=i,e)):[this.states[r]]}var o=s(r);return o.map((function(t){return n.getStateNode(t)})).concat(o.reduce((function(t,e){var i=n.getStateNode(e).getStateNodes(r[e]);return t.concat(i)}),[]))},o.prototype.handles=function(t){var e=u(t);return this.events.includes(e)},o.prototype.resolveState=function(e){var n=Array.from(Nt([],this.getStateNodes(e.value)));return new Vt(t(t({},e),{value:this.resolve(e.value),configuration:n}))},o.prototype.transitionLeafNode=function(t,e,n){var r=this.getStateNode(t).next(e,n);return r&&r.transitions.length?r:this.next(e,n)},o.prototype.transitionCompoundNode=function(t,e,n){var r=s(t),i=this.getStateNode(r[0])._transition(t[r[0]],e,n);return i&&i.transitions.length?i:this.next(e,n)},o.prototype.transitionParallelNode=function(t,e,r){var i,o,a={};try{for(var c=n(s(t)),u=c.next();!u.done;u=c.next()){var h=u.value,f=t[h];if(f){var l=this.getStateNode(h)._transition(f,e,r);l&&(a[h]=l)}}}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}var d=s(a).map((function(t){return a[t]})),v=g(d.map((function(t){return t.transitions})));if(!d.some((function(t){return t.transitions.length>0})))return this.next(e,r);var p=g(d.map((function(t){return t.entrySet}))),y=g(s(a).map((function(t){return a[t].configuration})));return{transitions:v,entrySet:p,exitSet:g(d.map((function(t){return t.exitSet}))),configuration:y,source:e,actions:g(s(a).map((function(t){return a[t].actions})))}},o.prototype._transition=function(t,e,n){return T(t)?this.transitionLeafNode(t,e,n):1===s(t).length?this.transitionCompoundNode(t,e,n):this.transitionParallelNode(t,e,n)},o.prototype.next=function(t,e){var r,o,a,s=this,u=e.name,h=[],l=[];try{for(var d=n(this.getCandidates(u)),v=d.next();!v.done;v=d.next()){var y=v.value,m=y.cond,x=y.in,w=t.context,S=!x||(T(x)&&Ft(x)?t.matches(f(this.getStateNodeById(x).path,this.delimiter)):c(f(x,this.delimiter),p(this.path.slice(0,-2))(t.value))),b=!1;try{b=!m||R(this.machine,m,w,e,t)}catch(t){throw new Error("Unable to evaluate guard '"+(m.name||m.type)+"' in transition for event '"+u+"' in state node '"+this.id+"':\n"+t.message)}if(b&&S){void 0!==y.target&&(l=y.target),h.push.apply(h,i(y.actions)),a=y;break}}}catch(t){r={error:t}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(r)throw r.error}}if(a){if(!l.length)return{transitions:[a],entrySet:[],exitSet:[],configuration:t.value?[this]:[],source:t,actions:h};var _=g(l.map((function(e){return s.getRelativeStateNodes(e,t.historyValue)}))),E=!!a.internal;return{transitions:[a],entrySet:E?[]:g(_.map((function(t){return s.nodesFromChild(t)}))),exitSet:E?[]:[this],configuration:_,source:t,actions:h}}},o.prototype.nodesFromChild=function(t){if(t.escapes(this))return[];for(var e=[],n=t;n&&n!==this;)e.push(n),n=n.parent;return e.push(this),e},o.prototype.escapes=function(t){if(this===t)return!1;for(var e=this.parent;e;){if(e===t)return!1;e=e.parent}return!0},o.prototype.getActions=function(t,e,o,a){var s,c,u,h,f=Nt([],a?this.getStateNodes(a.value):[this]),l=t.configuration.length?Nt(f,t.configuration):f;try{for(var d=n(l),v=d.next();!v.done;v=d.next()){Pt(f,m=v.value)||t.entrySet.push(m)}}catch(t){s={error:t}}finally{try{v&&!v.done&&(c=d.return)&&c.call(d)}finally{if(s)throw s.error}}try{for(var p=n(f),y=p.next();!y.done;y=p.next()){var m;Pt(l,m=y.value)&&!Pt(t.exitSet,m.parent)||t.exitSet.push(m)}}catch(t){u={error:t}}finally{try{y&&!y.done&&(h=p.return)&&h.call(p)}finally{if(u)throw u.error}}t.source||(t.exitSet=[],t.entrySet.push(this));var x=g(t.entrySet.map((function(n){var r=[];if("final"!==n.type)return r;var i=n.parent;if(!i.parent)return r;r.push(gt(n.id,n.doneData),gt(i.id,n.doneData?w(n.doneData,e,o):void 0));var a=i.parent;return"parallel"===a.type&&_t(a).every((function(e){return Ct(t.configuration,e)}))&&r.push(gt(a.id)),r})));t.exitSet.sort((function(t,e){return e.order-t.order})),t.entrySet.sort((function(t,e){return t.order-e.order}));var S=new Set(t.entrySet),b=new Set(t.exitSet),_=r([g(Array.from(S).map((function(t){return i(t.activities.map((function(t){return dt(t)})),t.onEntry)}))).concat(x.map(st)),g(Array.from(b).map((function(t){return i(t.onExit,t.activities.map((function(t){return vt(t)})))})))],2),E=_[0],N=_[1];return ot(N.concat(t.actions).concat(E),this.machine.options.actions)},o.prototype.transition=function(t,e,n){void 0===t&&(t=this.initialState);var r,o,s=A(e);if(t instanceof Vt)r=void 0===n?t:this.resolveState(Vt.from(t,n));else{var c=T(t)?this.resolve(l(this.getResolvedPath(t))):this.resolve(t),u=n||this.machine.context;r=this.resolveState(Vt.from(c,u))}if(!a&&"*"===s.name)throw new Error("An event cannot have the wildcard type ('*')");if(this.strict&&!this.events.includes(s.name)&&(o=s.name,!/^(done|error)\./.test(o)))throw new Error("Machine '"+this.id+"' does not accept event '"+s.name+"'");var h=this._transition(r.value,r,s)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:r,actions:[]},f=Nt([],this.getStateNodes(r.value)),d=h.configuration.length?Nt(f,h.configuration):f;return h.configuration=i(d),this.resolveTransition(h,r,s)},o.prototype.resolveRaisedTransition=function(t,e,n){var r,o=t.actions;return(t=this.transition(t,e))._event=n,t.event=n.data,(r=t.actions).unshift.apply(r,i(o)),t},o.prototype.resolveTransition=function(e,i,o,a){var s,c,u=this;void 0===o&&(o=nt),void 0===a&&(a=this.machine.context);var h=e.configuration,f=!i||e.transitions.length>0?kt(this.machine,h):void 0,l=i?i.historyValue?i.historyValue:e.source?this.machine.historyValue(i.value):void 0:void 0,d=i?i.context:a,v=this.getActions(e,d,o,i),p=i?t({},i.activities):{};try{for(var y=n(v),g=y.next();!g.done;g=y.next()){var m=g.value;m.type===J?p[m.activity.id||m.activity.type]=m:m.type===U&&(p[m.activity.id||m.activity.type]=!1)}}catch(t){s={error:t}}finally{try{g&&!g.done&&(c=y.return)&&c.call(y)}finally{if(s)throw s.error}}var x,S,E=r(St(this,i,d,o,v),2),N=E[0],O=E[1],T=r(b(N,(function(t){return t.type===B||t.type===q&&t.to===D.Internal})),2),k=T[0],P=T[1],C=N.filter((function(t){var e;return t.type===J&&(null===(e=t.activity)||void 0===e?void 0:e.type)===K})).reduce((function(t,e){return t[e.activity.id]=function(t,e,n,r){var i,o=z(t.src),a=null===(i=null==e?void 0:e.options.services)||void 0===i?void 0:i[o.type],s=t.data?w(t.data,n,r):void 0,c=a?At(a,t.id,s):Lt(t.id);return c.meta=t,c}(e.activity,u.machine,O,o),t}),i?t({},i.children):{}),j=f?e.configuration:i?i.configuration:[],V=j.reduce((function(t,e){return void 0!==e.meta&&(t[e.id]=e.meta),t}),{}),I=Ct(j,this),L=new Vt({value:f||i.value,context:O,_event:o,_sessionid:i?i._sessionid:null,historyValue:f?l?(x=l,S=f,{current:S,states:_(x,S)}):void 0:i?i.historyValue:void 0,history:!f||e.source?i:void 0,actions:f?P:[],activities:f?p:i?i.activities:{},meta:f?V:i?i.meta:void 0,events:[],configuration:j,transitions:e.transitions,children:C,done:I}),A=d!==O;L.changed=o.name===Z||A;var M=L.history;if(M&&delete M.history,!f)return L;var R=L;if(!I)for((this._transient||h.some((function(t){return t._transient})))&&(R=this.resolveRaisedTransition(R,{type:X},o));k.length;){var F=k.shift();R=this.resolveRaisedTransition(R,F._event,o)}var $=R.changed||(M?!!R.actions.length||A||typeof M.value!=typeof R.value||!jt(R.value,M.value):void 0);return R.changed=$,R.history=M,R},o.prototype.getStateNode=function(t){if(Ft(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '"+t+"' from '"+this.id+"'; no child states exist.");var e=this.states[t];if(!e)throw new Error("Child state '"+t+"' does not exist on '"+this.id+"'");return e},o.prototype.getStateNodeById=function(t){var e=Ft(t)?t.slice("#".length):t;if(e===this.id)return this;var n=this.machine.idMap[e];if(!n)throw new Error("Child state node '#"+e+"' does not exist on machine '"+this.id+"'");return n},o.prototype.getStateNodeByPath=function(t){if("string"==typeof t&&Ft(t))try{return this.getStateNodeById(t.slice(1))}catch(t){}for(var e=h(t,this.delimiter).slice(),n=this;e.length;){var r=e.shift();if(!r.length)break;n=n.getStateNode(r)}return n},o.prototype.resolve=function(t){var e,n=this;if(!t)return this.initialStateValue||zt;switch(this.type){case"parallel":return d(this.initialStateValue,(function(e,r){return e?n.getStateNode(r).resolve(t[r]||e):zt}));case"compound":if(T(t)){var r=this.getStateNode(t);return"parallel"===r.type||"compound"===r.type?((e={})[t]=r.initialStateValue,e):t}return s(t).length?d(t,(function(t,e){return t?n.getStateNode(e).resolve(t):zt})):this.initialStateValue||{};default:return t||zt}},o.prototype.getResolvedPath=function(t){if(Ft(t)){var e=this.machine.idMap[t.slice("#".length)];if(!e)throw new Error("Unable to find state node '"+t+"'");return e.path}return h(t,this.delimiter)},Object.defineProperty(o.prototype,"initialStateValue",{get:function(){var t,e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;if("parallel"===this.type)e=v(this.states,(function(t){return t.initialStateValue||zt}),(function(t){return!("history"===t.type)}));else if(void 0!==this.initial){if(!this.states[this.initial])throw new Error("Initial state '"+this.initial+"' not found on '"+this.key+"'");e=bt(this.states[this.initial])?this.initial:((t={})[this.initial]=this.states[this.initial].initialStateValue,t)}return this.__cache.initialStateValue=e,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),o.prototype.getInitialState=function(t,e){var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,entrySet:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,void 0,e)},Object.defineProperty(o.prototype,"initialState",{get:function(){this._init();var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '"+this.id+"'.");return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"target",{get:function(){var t;if("history"===this.type){var e=this.config;t=T(e.target)&&Ft(e.target)?l(this.machine.getStateNodeById(e.target).path.slice(this.path.length-1)):e.target}return t},enumerable:!1,configurable:!0}),o.prototype.getRelativeStateNodes=function(t,e,n){return void 0===n&&(n=!0),n?"history"===t.type?t.resolveHistory(e):t.initialStateNodes:[t]},Object.defineProperty(o.prototype,"initialStateNodes",{get:function(){var t=this;return bt(this)?[this]:"compound"!==this.type||this.initial?g(y(this.initialStateValue).map((function(e){return t.getFromRelativePath(e)}))):(a||E(!1,"Compound state node '"+this.id+"' has no initial state."),[this])},enumerable:!1,configurable:!0}),o.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var e=r(t),n=e[0],i=e.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '"+n+"' from node with no states");var o=this.getStateNode(n);if("history"===o.type)return o.resolveHistory();if(!this.states[n])throw new Error("Child state '"+n+"' does not exist on '"+this.id+"'");return this.states[n].getFromRelativePath(i)},o.prototype.historyValue=function(t){if(s(this.states).length)return{current:t||this.initialStateValue,states:v(this.states,(function(e,n){if(!t)return e.historyValue();var r=T(t)?void 0:t[n];return e.historyValue(r||e.initialStateValue)}),(function(t){return!t.history}))}},o.prototype.resolveHistory=function(t){var e=this;if("history"!==this.type)return[this];var r=this.parent;if(!t){var i=this.target;return i?g(y(i).map((function(t){return r.getFromRelativePath(t)}))):r.initialStateNodes}var o,a,s=(o=r.path,a="states",function(t){var e,r,i=t;try{for(var s=n(o),c=s.next();!c.done;c=s.next()){var u=c.value;i=i[a][u]}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}return i})(t).current;return T(s)?[r.getStateNode(s)]:g(y(s).map((function(t){return"deep"===e.history?r.getFromRelativePath(t):[r.states[t[0]]]})))},Object.defineProperty(o.prototype,"stateIds",{get:function(){var t=this,e=g(s(this.states).map((function(e){return t.states[e].stateIds})));return[this.id].concat(e)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"events",{get:function(){var t,e,r,i;if(this.__cache.events)return this.__cache.events;var o=this.states,a=new Set(this.ownEvents);if(o)try{for(var c=n(s(o)),u=c.next();!u.done;u=c.next()){var h=o[u.value];if(h.states)try{for(var f=(r=void 0,n(h.events)),l=f.next();!l.done;l=f.next()){var d=l.value;a.add(""+d)}}catch(t){r={error:t}}finally{try{l&&!l.done&&(i=f.return)&&i.call(f)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter((function(t){return!(!t.target&&!t.actions.length&&t.internal)})).map((function(t){return t.eventType})));return Array.from(t)},enumerable:!1,configurable:!0}),o.prototype.resolveTarget=function(t){var e=this;if(void 0!==t)return t.map((function(t){if(!T(t))return t;var n=t[0]===e.delimiter;if(n&&!e.parent)return e.getStateNodeByPath(t.slice(1));var r=n?e.key+t:t;if(!e.parent)return e.getStateNodeByPath(r);try{return e.parent.getStateNodeByPath(r)}catch(t){throw new Error("Invalid transition definition for state node '"+e.id+"':\n"+t.message)}}))},o.prototype.formatTransition=function(e){var n=this,r=function(t){if(void 0!==t&&""!==t)return x(t)}(e.target),i="internal"in e?e.internal:!r||r.some((function(t){return T(t)&&t[0]===n.delimiter})),o=this.machine.options.guards,a=this.resolveTarget(r),s=t(t({},e),{actions:ot(x(e.actions)),cond:k(e.cond,o),target:a,source:this,internal:i,eventType:e.event,toJSON:function(){return t(t({},s),{target:s.target?s.target.map((function(t){return"#"+t.id})):void 0,source:"#"+n.id})}});return s},o.prototype.formatTransitions=function(){var t,r,o,c=this;if(this.config.on)if(Array.isArray(this.config.on))o=this.config.on;else{var u=this.config.on,h="*",f=u[h],l=void 0===f?[]:f,d=e(u,["*"]);o=g(s(d).map((function(t){a||""!==t||E(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. Please check the `on` configuration for \"#"+c.id+'".');var e=M(t,d[t]);return a||function(t,e,n){var r=n.slice(0,-1).some((function(t){return!("cond"in t)&&!("in"in t)&&(T(t.target)||j(t.target))}));E(!r,"One or more transitions for "+(""===e?"the transient event":"event '"+e+"'")+" on state '"+t.id+"' are unreachable. Make sure that the default transition is the last one defined.")}(c,t,e),e})).concat(M("*",l)))}else o=[];var v=this.config.always?M("",this.config.always):[],p=this.config.onDone?M(String(gt(this.id)),this.config.onDone):[];a||E(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'+this.id+'".');var y=g(this.invoke.map((function(t){var e=[];return t.onDone&&e.push.apply(e,i(M(String(mt(t.id)),t.onDone))),t.onError&&e.push.apply(e,i(M(String(xt(t.id)),t.onError))),e}))),m=this.after,w=g(i(p,y,o,v).map((function(t){return x(t).map((function(t){return c.formatTransition(t)}))})));try{for(var S=n(m),b=S.next();!b.done;b=S.next()){var _=b.value;w.push(_)}}catch(e){t={error:e}}finally{try{b&&!b.done&&(r=S.return)&&r.call(S)}finally{if(t)throw t.error}}return w},o}();function Ut(t,e,n){void 0===n&&(n=t.context);var r="function"==typeof n?n():n;return new Jt(t,e,r)}function Bt(t,e){var n="function"==typeof t.context?t.context():t.context;return new Jt(t,e,n)}var qt={deferEvents:!1},$t=function(){function e(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=t(t({},qt),e)}return e.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents)return void this.schedule(t);this.process(t)}this.flushEvents()},e.prototype.schedule=function(t){if(this.initialized&&!this.processingEvent){if(0!==this.queue.length)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()}else this.queue.push(t)},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},e.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(t){throw this.clear(),t}finally{this.processingEvent=!1}},e}(),Xt=new Map,Ht=0,Gt=function(){return"x:"+Ht++},Wt=function(t,e){return Xt.set(t,e),t},Kt=function(t){return Xt.get(t)},Qt=function(t){Xt.delete(t)};function Yt(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0}function Zt(t){if(!a&&Yt()){var e=function(){var t=Yt();if(t&&"__xstate__"in t)return t.__xstate__}();e&&e.register(t)}}var te,ee={sync:!1,autoForward:!1};!function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"}(te||(te={}));var ne=function(){function e(n,r){var i=this;void 0===r&&(r=e.defaultOptions),this.machine=n,this.scheduler=new $t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=te.NotStarted,this.children=new Map,this.forwardTo=new Set,this.init=this.start,this.send=function(t,e){if(N(t))return i.batch(t),i.state;var n=A(L(t,e));if(i.status===te.Stopped)return a||E(!1,'Event "'+n.name+'" was sent to stopped service "'+i.machine.id+'". This service has already reached its final state, and will not transition.\nEvent: '+JSON.stringify(n.data)),i.state;if(i.status!==te.Running&&!i.options.deferEvents)throw new Error('Event "'+n.name+'" was sent to uninitialized service "'+i.machine.id+'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.\nEvent: '+JSON.stringify(n.data));return i.scheduler.schedule((function(){i.forward(n);var t=i.nextState(n);i.update(t,n)})),i._state},this.sendTo=function(e,n){var r,o=i.parent&&(n===D.Parent||i.parent.id===n),s=o?i.parent:T(n)?i.children.get(n)||Kt(n):(r=n)&&"function"==typeof r.send?n:void 0;if(s)"machine"in s?s.send(t(t({},e),{name:e.name===Y?""+xt(i.id):e.name,origin:i.sessionId})):s.send(e.data);else{if(!o)throw new Error("Unable to send event to child '"+n+"' from service '"+i.id+"'.");a||E(!1,"Service '"+i.id+"' has no parent: unable to send event "+e.type)}};var o=t(t({},e.defaultOptions),r),s=o.clock,c=o.logger,u=o.parent,h=o.id,f=void 0!==h?h:n.id;this.id=f,this.logger=c,this.clock=s,this.parent=u,this.options=o,this.scheduler=new $t({deferEvents:this.options.deferEvents}),this.sessionId=Gt()}return Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:It(this,(function(){return t._initialState=t.machine.initialState,t._initialState}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return a||E(this.status!==te.NotStarted,"Attempted to read state from uninitialized service '"+this.id+"'. Make sure the service is started first."),this._state},enumerable:!1,configurable:!0}),e.prototype.execute=function(t,e){var r,i;try{for(var o=n(t.actions),a=o.next();!a.done;a=o.next()){var s=a.value;this.exec(s,t,e)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e.prototype.update=function(t,e){var r,i,o,a,s,c,u,h,f=this;if(t._sessionid=this.sessionId,this._state=t,this.options.execute&&this.execute(this.state),this.children.forEach((function(t){f.state.children[t.id]=t})),this.devTools&&this.devTools.send(e.data,t),t.event)try{for(var l=n(this.eventListeners),d=l.next();!d.done;d=l.next()){(0,d.value)(t.event)}}catch(t){r={error:t}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}try{for(var v=n(this.listeners),p=v.next();!p.done;p=v.next()){(0,p.value)(t,t.event)}}catch(t){o={error:t}}finally{try{p&&!p.done&&(a=v.return)&&a.call(v)}finally{if(o)throw o.error}}try{for(var y=n(this.contextListeners),g=y.next();!g.done;g=y.next()){(0,g.value)(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(t){s={error:t}}finally{try{g&&!g.done&&(c=y.return)&&c.call(y)}finally{if(s)throw s.error}}var m=Ct(t.configuration||[],this.machine);if(this.state.configuration&&m){var x=t.configuration.find((function(t){return"final"===t.type&&t.parent===f.machine})),S=x&&x.doneData?w(x.doneData,t.context,e):void 0;try{for(var b=n(this.doneListeners),_=b.next();!_.done;_=b.next()){(0,_.value)(mt(this.id,S))}}catch(t){u={error:t}}finally{try{_&&!_.done&&(h=b.return)&&h.call(b)}finally{if(u)throw u.error}}this.stop()}},e.prototype.onTransition=function(t){return this.listeners.add(t),this.status===te.Running&&t(this.state,this.state.event),this},e.prototype.subscribe=function(t,e,n){var r,i=this;if(!t)return{unsubscribe:function(){}};var o=n;return"function"==typeof t?r=t:(r=t.next.bind(t),o=t.complete.bind(t)),this.listeners.add(r),this.status===te.Running&&r(this.state),o&&this.onDone(o),{unsubscribe:function(){r&&i.listeners.delete(r),o&&i.doneListeners.delete(o)}}},e.prototype.onEvent=function(t){return this.eventListeners.add(t),this},e.prototype.onSend=function(t){return this.sendListeners.add(t),this},e.prototype.onChange=function(t){return this.contextListeners.add(t),this},e.prototype.onStop=function(t){return this.stopListeners.add(t),this},e.prototype.onDone=function(t){return this.doneListeners.add(t),this},e.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},e.prototype.start=function(t){var e=this;if(this.status===te.Running)return this;Wt(this.sessionId,this),this.initialized=!0,this.status=te.Running;var n=void 0===t?this.initialState:It(this,(function(){return!T(n=t)&&"value"in n&&"history"in n?e.machine.resolveState(t):e.machine.resolveState(Vt.from(t,e.machine.context));var n}));return this.options.devTools&&this.attachDev(),this.scheduler.initialize((function(){e.update(n,nt)})),this},e.prototype.stop=function(){var t,e,r,i,o,a,c,u,h,f,l=this;try{for(var d=n(this.listeners),v=d.next();!v.done;v=d.next()){var p=v.value;this.listeners.delete(p)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(e=d.return)&&e.call(d)}finally{if(t)throw t.error}}try{for(var y=n(this.stopListeners),g=y.next();!g.done;g=y.next()){(p=g.value)(),this.stopListeners.delete(p)}}catch(t){r={error:t}}finally{try{g&&!g.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}try{for(var m=n(this.contextListeners),x=m.next();!x.done;x=m.next()){p=x.value;this.contextListeners.delete(p)}}catch(t){o={error:t}}finally{try{x&&!x.done&&(a=m.return)&&a.call(m)}finally{if(o)throw o.error}}try{for(var w=n(this.doneListeners),S=w.next();!S.done;S=w.next()){p=S.value;this.doneListeners.delete(p)}}catch(t){c={error:t}}finally{try{S&&!S.done&&(u=w.return)&&u.call(w)}finally{if(c)throw c.error}}this.state.configuration.forEach((function(t){var e,r;try{for(var i=n(t.definition.exit),o=i.next();!o.done;o=i.next()){var a=o.value;l.exec(a,l.state)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}})),this.children.forEach((function(t){O(t.stop)&&t.stop()}));try{for(var b=n(s(this.delayedEventsMap)),_=b.next();!_.done;_=b.next()){var E=_.value;this.clock.clearTimeout(this.delayedEventsMap[E])}}catch(t){h={error:t}}finally{try{_&&!_.done&&(f=b.return)&&f.call(b)}finally{if(h)throw h.error}}return this.scheduler.clear(),this.initialized=!1,this.status=te.Stopped,Qt(this.sessionId),this},e.prototype.batch=function(e){var r=this;if(this.status===te.NotStarted&&this.options.deferEvents)a||E(!1,e.length+' event(s) were sent to uninitialized service "'+this.machine.id+'" and are deferred. Make sure .start() is called for this service.\nEvent: '+JSON.stringify(event));else if(this.status!==te.Running)throw new Error(e.length+' event(s) were sent to uninitialized service "'+this.machine.id+'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.');this.scheduler.schedule((function(){var o,a,s=r.state,c=!1,u=[],h=function(e){var n=A(e);r.forward(n),s=It(r,(function(){return r.machine.transition(s,n)})),u.push.apply(u,i(s.actions.map((function(e){return r=s,i=(n=e).exec,t(t({},n),{exec:void 0!==i?function(){return i(r.context,r.event,{action:n,state:r,_event:r._event})}:void 0});var n,r,i})))),c=c||!!s.changed};try{for(var f=n(e),l=f.next();!l.done;l=f.next()){h(l.value)}}catch(t){o={error:t}}finally{try{l&&!l.done&&(a=f.return)&&a.call(f)}finally{if(o)throw o.error}}s.changed=c,s.actions=u,r.update(s,A(e[e.length-1]))}))},e.prototype.sender=function(t){return this.send.bind(this,t)},e.prototype.nextState=function(t){var e=this,n=A(t);if(0===n.name.indexOf(Q)&&!this.state.nextEvents.some((function(t){return 0===t.indexOf(Q)})))throw n.data.data;return It(this,(function(){return e.machine.transition(e.state,n)}))},e.prototype.forward=function(t){var e,r;try{for(var i=n(this.forwardTo),o=i.next();!o.done;o=i.next()){var a=o.value,s=this.children.get(a);if(!s)throw new Error("Unable to forward event '"+t+"' from interpreter '"+this.id+"' to nonexistant child '"+a+"'.");s.send(t)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},e.prototype.defer=function(t){var e=this;this.delayedEventsMap[t.id]=this.clock.setTimeout((function(){t.to?e.sendTo(t._event,t.to):e.send(t._event)}),t.delay)},e.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},e.prototype.exec=function(t,e,n){void 0===n&&(n=this.machine.options.actions);var r=e.context,i=e._event,o=t.exec||rt(t.type,n),s=O(o)?o:o?o.exec:t.exec;if(s)try{return s(r,i.data,{action:t,state:this.state,_event:i})}catch(t){throw this.parent&&this.parent.send({type:"xstate.error",data:t}),t}switch(t.type){case q:var c=t;if("number"==typeof c.delay)return void this.defer(c);c.to?this.sendTo(c._event,c.to):this.send(c._event);break;case $:this.cancel(t.sendId);break;case J:var u=t.activity;if(!this.state.activities[u.id||u.type])break;if(u.type===V.Invoke){var h=z(u.src),f=this.machine.options.services?this.machine.options.services[h.type]:void 0,l=u.id,d=u.data;a||E(!("forward"in u),"`forward` property is deprecated (found in invocation of '"+u.src+"' in in machine '"+this.machine.id+"'). Please use `autoForward` instead.");var v="autoForward"in u?u.autoForward:!!u.forward;if(!f)return void(a||E(!1,"No service found for invocation '"+u.src+"' in machine '"+this.machine.id+"'."));var p=d?w(d,r,i):void 0,y=O(f)?f(r,i.data,{data:p,src:h}):f;S(y)?this.spawnPromise(Promise.resolve(y),l):O(y)?this.spawnCallback(y,l):P(y)?this.spawnObservable(y,l):j(y)&&this.spawnMachine(p?y.withContext(p):y,{id:l,autoForward:v})}else this.spawnActivity(u);break;case U:this.stopChild(t.activity.id);break;case G:var g=t.label,m=t.value;g?this.logger(g,m):this.logger(m);break;default:a||E(!1,"No implementation found for action type '"+t.type+"'")}},e.prototype.removeChild=function(t){this.children.delete(t),this.forwardTo.delete(t),delete this.state.children[t]},e.prototype.stopChild=function(t){var e=this.children.get(t);e&&(this.removeChild(t),O(e.stop)&&e.stop())},e.prototype.spawn=function(e,n,r){if(S(e))return this.spawnPromise(Promise.resolve(e),n);if(O(e))return this.spawnCallback(e,n);if(function(t){try{return"function"==typeof t.send}catch(t){return!1}}(i=e)&&"id"in i)return this.spawnActor(e);if(P(e))return this.spawnObservable(e,n);if(j(e))return this.spawnMachine(e,t(t({},r),{id:n}));throw new Error('Unable to spawn entity "'+n+'" of type "'+typeof e+'".');var i},e.prototype.spawnMachine=function(n,r){var i=this;void 0===r&&(r={});var o=new e(n,t(t({},this.options),{parent:this,id:r.id||n.id})),a=t(t({},ee),r);a.sync&&o.onTransition((function(t){i.send(Z,{state:t,id:o.id})}));var s=o;return this.children.set(o.id,s),a.autoForward&&this.forwardTo.add(o.id),o.onDone((function(t){i.removeChild(o.id),i.send(A(t,{origin:o.id}))})).start(),s},e.prototype.spawnPromise=function(t,e){var n=this,r=!1;t.then((function(t){r||(n.removeChild(e),n.send(A(mt(e,t),{origin:e})))}),(function(t){if(!r){n.removeChild(e);var i=xt(e,t);try{n.send(A(i,{origin:e}))}catch(r){!function(t,e,n){if(!a){var r=t.stack?" Stacktrace was '"+t.stack+"'":"";if(t===e)console.error("Missing onError handler for invocation '"+n+"', error was '"+t+"'."+r);else{var i=e.stack?" Stacktrace was '"+e.stack+"'":"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '"+n+"'. Original error: '"+t+"'. "+r+" Current error is '"+e+"'."+i)}}}(t,r,e),n.devTools&&n.devTools.send(i,n.state),n.machine.strict&&n.stop()}}}));var i={id:e,send:function(){},subscribe:function(e,n,r){var i=function(t,e,n){if("object"==typeof t)return t;var r=function(){};return{next:t,error:e||r,complete:n||r}}(e,n,r),o=!1;return t.then((function(t){o||(i.next(t),o||i.complete())}),(function(t){o||i.error(t)})),{unsubscribe:function(){return o=!0}}},stop:function(){r=!0},toJSON:function(){return{id:e}}};return this.children.set(e,i),i},e.prototype.spawnCallback=function(t,e){var n,r=this,i=!1,o=new Set,a=new Set;try{n=t((function(t){a.forEach((function(e){return e(t)})),i||r.send(A(t,{origin:e}))}),(function(t){o.add(t)}))}catch(t){this.send(xt(e,t))}if(S(n))return this.spawnPromise(n,e);var s={id:e,send:function(t){return o.forEach((function(e){return e(t)}))},subscribe:function(t){return a.add(t),{unsubscribe:function(){a.delete(t)}}},stop:function(){i=!0,O(n)&&n()},toJSON:function(){return{id:e}}};return this.children.set(e,s),s},e.prototype.spawnObservable=function(t,e){var n=this,r=t.subscribe((function(t){n.send(A(t,{origin:e}))}),(function(t){n.removeChild(e),n.send(A(xt(e,t),{origin:e}))}),(function(){n.removeChild(e),n.send(A(mt(e),{origin:e}))})),i={id:e,send:function(){},subscribe:function(e,n,r){return t.subscribe(e,n,r)},stop:function(){return r.unsubscribe()},toJSON:function(){return{id:e}}};return this.children.set(e,i),i},e.prototype.spawnActor=function(t){return this.children.set(t.id,t),t},e.prototype.spawnActivity=function(t){var e=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(e){var n=e(this.state.context,t);this.spawnEffect(t.id,n)}else a||E(!1,"No implementation found for activity '"+t.type+"'")},e.prototype.spawnEffect=function(t,e){this.children.set(t,{id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:e||void 0,toJSON:function(){return{id:t}}})},e.prototype.attachDev=function(){var e=Yt();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var n="object"==typeof this.options.devTools?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(t(t({name:this.id,autoPause:!0,stateSanitizer:function(t){return{value:t.value,context:t.context,actions:t.actions}}},n),{features:t({jump:!1,skip:!1},n?n.features:void 0)}),this.machine),this.devTools.init(this.state)}Zt(this)}},e.prototype.toJSON=function(){return{id:this.id}},e.prototype[C]=function(){return this},e.defaultOptions=function(t){return{execute:!0,deferEvents:!0,clock:{setTimeout:function(t,e){return setTimeout(t,e)},clearTimeout:function(t){return clearTimeout(t)}},logger:t.console.log.bind(console),devTools:!1}}("undefined"!=typeof self?self:global),e.interpret=ie,e}();function re(e,n){var r=function(e){return T(e)?t(t({},ee),{name:e}):t(t(t({},ee),{name:I()}),e)}(n);return function(t){if(!a){var n=j(e)||O(e);E(!!t||n,'Attempted to spawn an Actor (ID: "'+(j(e)?e.id:"undefined")+'") outside of a service. This will have no effect.')}return t?t.spawn(e,r.name,r):At(e,r.name)}(Dt[Dt.length-1])}function ie(t,e){return new ne(t,e)}function oe(t,e,i){var o,a,s=Vt.from(t,t instanceof Vt?t.context:void 0);try{for(var c=n(e),u=c.next();!u.done;u=c.next()){var h=r(u.value,2),f=h[0],l=h[1];if(s.matches(f))return l(s)}}catch(t){o={error:t}}finally{try{u&&!u.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}return i(s)}var ae={raise:st,send:ct,sendParent:ut,sendUpdate:ht,log:function(t,e){return void 0===t&&(t=ft),{type:G,label:e,expr:t}},cancel:lt,start:dt,stop:vt,assign:pt,after:yt,done:gt,respond:function(e,n){return ct(e,t(t({},n),{to:function(t,e,n){return n._event.origin}}))},forwardTo:wt,escalate:function(e,n){return ut((function(t,n,r){return{type:Y,data:O(e)?e(t,n,r):e}}),t(t({},n),{to:D.Parent}))},choose:function(t){return{type:V.Choose,conds:t}},pure:function(t){return{type:V.Pure,get:t}}};export{V as ActionTypes,ne as Interpreter,te as InterpreterStatus,Ut as Machine,D as SpecialTargets,Vt as State,Jt as StateNode,ae as actions,pt as assign,Bt as createMachine,mt as doneInvoke,wt as forwardTo,ie as interpret,F as mapState,oe as matchState,c as matchesState,ct as send,ut as sendParent,ht as sendUpdate,re as spawn};

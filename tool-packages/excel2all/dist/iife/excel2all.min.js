var excel2all=function(e,t,l,r,n,i,o,a,s){"use strict";const c={};c.int=function(e,t){let l={};"string"==typeof t&&""!==t.trim()?l.value=t.includes(".")?parseFloat(t):parseInt(t):"number"==typeof t&&(l.value=t);return l},c.string=function(e,t){let l={};"string"==typeof t?""!==(t=t.trim())&&(l.value=t):l.value=t+"";return l},c["[int]"]=function(e,t){let l;t=(t=(t+"").replace(/\uff0c/g,",")).trim();const r={};if(""!==t)try{l=JSON.parse(t),r.value=l}catch(e){r.error=e}return r},c["[string]"]=function(e,t){t=(t=(t+"").replace(/\uff0c/g,",")).trim();let l,r={};if(""!==t)try{l=JSON.parse(t),r.value=l}catch(e){r.error=e}return r},c.json=function(e,t){let l,r;if(""!==(t=(t=(t+"").replace(/\uff0c/g,",")).trim()))try{l=JSON.parse(t)}catch(e){r=e,l=t}return{error:r,value:l}};const f="win32"===t.platform()?"\n":"\r\n";var u;!function(e){e[e.info=0]="info",e[e.warn=1]="warn",e[e.error=2]="error",e[e.no=3]="no"}(u||(u={}));class h{static init(e){const t=e.logLevel?e.logLevel:"info";this._logLevel=u[t],this._enableOutPutLogFile=!1!==e.outputLogDirPath}static log(e,t="info"){if("no"!==t&&this._logLevel<=u[t])switch(t){case"error":console.error(e),this.hasError||(this.hasError=!0);break;case"info":console.log(e);break;case"warn":console.warn(e)}this._enableOutPutLogFile&&(this._logStr+=e+f)}static systemLog(e){console.log(e),this._enableOutPutLogFile&&(this._logStr+=e+f)}static get logStr(){if(!this._enableOutPutLogFile)return null;const e=this._logStr;return this._logStr="",e}}function d(e){return!e||void 0===e.v||("string"==typeof e.v?""===e.v:"number"==typeof e.v&&isNaN(e.v))}h._logStr="",h.hasError=!1;function g(e){let t;for(let l=e.length-1;l>=0;l--){if(e[l]<90){e[l]+=1,t=!0;break}90===e[l]&&(e[l]=65)}return t||e.push(65),p(e)}function p(e){return String.fromCharCode(...e)}function b(e){const t=[];for(let l=0;l<e.length;l++)t.push(e.charCodeAt(l));return t}function m(e,t,l,r,n,i,o,a){const s=e["!ref"],c=parseInt(s.match(/\d+$/)[0]);let f,u,h=v(s.split(":")[1].match(/^[A-Za-z]+/)[0]),d=0;const p=b(l);for(let s=t;s<=c&&(!n||!n(e,s));s++){if(o&&o(e,s))continue;f=p.concat([]),u=l;let t=!i||!i(e,u);for(;t;)a&&a(e,u)||r(e,u,s),u=g(f),d=v(u),t=h>=d&&(!i||!i(e,u))}}function y(e,t,l,r,n,i,o,a){const s=e["!ref"],c=parseInt(s.match(/\d+$/)[0]),f=v(s.split(":")[1].match(/^[A-Za-z]+/)[0]);let u,h;u=b(l);let d=0;h=l;let p=!i||!i(e,h);for(;p;){if(!a||!a(e,h))for(let l=t;l<=c&&(!n||!n(e,l));l++)o&&o(e,l)||r(e,h,l);h=g(u),d=v(h),p=f>=d&&(!i||!i(e,h))}}let T={};function v(e){let t=T[e];if(!t){t=0;for(let l=0;l<e.length;l++)t+=e.charCodeAt(l);T[e]=t}return t}function F(e){return l.readFile(e.filePath,{type:N(e.fileExtName)?"string":"file"})}function N(e){return"csv"===e}var P;(P=e.TableType||(e.TableType={})).vertical="vertical",P.horizontal="horizontal";class S{constructor(){this._valueTransFuncMap=c}getTableDefine(t,l){const r=t.fileName,n={tableName:r};let i,o;const a=l.SheetNames;let s,c,f;for(let e=0;e<a.length&&(s=l.Sheets[a[e]],f=s.A1,d(f)||(c=this._getFirstCellValue(f),!c||c.tableNameInSheet!==r));e++);if(!c||c.tableNameInSheet!==r)return h.log(`\u8868\u683c\u4e0d\u89c4\u8303,\u8df3\u8fc7\u89e3\u6790,\u8def\u5f84:${t.filePath}`,"error"),null;if(n.tableType=c.tableType,n.tableType===e.TableType.vertical){n.verticalFieldDefine={};const e=n.verticalFieldDefine;e.textRow=1;for(let t=1;t<100&&(i="A"+t,o=s[i],d(o)||"NO"===o.v||"END"===o.v||"START"===o.v?n.startRow=t:"CLIENT"===o.v?e.fieldRow=t:"TYPE"===o.v&&(e.typeRow=t),!(n.startRow&&e.fieldRow&&e.typeRow));t++);n.startCol="B"}else if(n.tableType===e.TableType.horizontal){n.horizontalFieldDefine={};const e=n.horizontalFieldDefine;e.textCol="A",e.typeCol="B",e.fieldCol="C",n.startCol="E",n.startRow=2}return n}_getFirstCellValue(t){if(!t)return;const l=t.v.split(":");let r,n;return l.length>1?(r=l[1],n="H"===l[0]?e.TableType.horizontal:e.TableType.vertical):(r=l[0],n=e.TableType.vertical),{tableNameInSheet:r,tableType:n}}checkSheetCanParse(e,t,l){const r=t.A1,n=this._getFirstCellValue(r);return!(!r||!e)&&n.tableNameInSheet===e.tableName}isSheetRowEnd(e,t,l){if(l>1){const e=t["A"+(l-=1)];return e&&"END"===e.v}return!1}isSheetColEnd(e,t,l){return d(t[l+1])}checkRowNeedParse(e,t,l){const r=t["A"+l];return!r||"NO"!==r.v}parseVerticalCell(e,t,l,r,n){const i=this.getVerticalTableField(e,t,l,r);if(!i)return;const o=t[l+r];if(d(o))return;const a=this.transValue(e,i,o.v);a.error&&h.log(`!!!!!!!!!!!!!!!!!![-----\u89e3\u6790\u9519\u8bef-----]!!!!!!!!!!!!!!!!!!!!!!!!!\n[sheetName|\u5206\u8868\u540d]=> ${e.curSheetName}\n[row|\u884c]=> ${r}\n[col|\u5217]=> ${l}\n[field|\u5b57\u6bb5]=> ${i.originFieldName}\n[type|\u7c7b\u578b]=> ${i.originType}\n[error|\u9519\u8bef]=> ${"string"==typeof a.error?a.error:a.error.message}\n`,"error");const s=a.value;let c=e.mainKeyFieldName;c||(c=i.fieldName,e.mainKeyFieldName=i.fieldName,e.tableObj={});let f=e.curRowOrColObj;if(n&&(f={},e.curRowOrColObj=e.tableObj[s]=f),i.isMutiColObj){let e=f[i.fieldName];e||(e={},f[i.fieldName]=e),e[i.subFieldName]=s}else f[i.fieldName]=s}parseHorizontalCell(e,t,l,r,n){const i=this.getHorizontalTableField(e,t,l,r);if(!i)return;const o=t[l+r];if(d(o))return;const a=this.transValue(e,i,o.v);a.error&&h.log(`!!!!!!!!!!!!!!!!!![-----ParseError|\u89e3\u6790\u9519\u8bef-----]!!!!!!!!!!!!!!!!!!!!!!!!!\n[sheetName|\u5206\u8868\u540d]=> ${e.curSheetName}\n[row|\u884c]=> ${r}\n[col|\u5217]=> ${l}\n[field|\u5b57\u6bb5]=> ${i.originFieldName}\n[type|\u7c7b\u578b]=> ${i.originType}\n[error|\u9519\u8bef]=> ${"string"==typeof a.error?a.error:a.error.message}\n!!!!!!!!!!!!!!!!!![-----ParseError|\u89e3\u6790\u9519\u8bef-----]!!!!!!!!!!!!!!!!!!!!!!!!!\n`,"error");const s=a.value;if(e.tableObj||(e.tableObj={}),i.isMutiColObj){let t=e.tableObj[i.fieldName];t||(t={},e.tableObj[i.fieldName]=t),t[i.subFieldName]=s}else e.tableObj[i.fieldName]=s}getVerticalTableField(e,t,l,r){const n=e.tableDefine;let i=e.filedMap;i||(i={},e.filedMap=i);const o=n.verticalFieldDefine,a=t[l+o.fieldRow];let s;if(d(a)||(s=a.v),!s)return null;let c={};if(void 0!==i[s])return i[s];const f=t[l+o.textRow];d(f)||(c.text=f.v);let u=!1;const h=t[l+o.typeRow];if(d(h))return null;if(c.originType=h.v,c.originType.includes("mf:")){const e=c.originType.split(":");if(e.length<3)return null;c.type=e[2],u=!0}else c.type=c.originType;if(c.isMutiColObj=u,c.originFieldName=s,u){const e=c.originFieldName.split(":");if(e.length<2)return null;c.fieldName=e[0],c.subFieldName=e[1]}else c.fieldName=c.originFieldName;return i[l]=c,c}getHorizontalTableField(e,t,l,r){const n=e.tableDefine;let i=e.filedMap;i||(i={},e.filedMap=i);const o=n.horizontalFieldDefine,a=t[o.fieldCol+r];let s;if(d(a)||(s=a.v),!s)return null;if(void 0!==i[s])return i[s];let c={};const f=t[o.textCol+r];d(f)||(c.text=f.v);let u=!1;const h=t[o.typeCol+r];if(d(h))return null;if(c.originType=h.v,c.originType.includes("mf:")){const e=c.originType.split(":");if(e.length<3)return null;c.type=e[2],u=!0}else c.type=c.originType;if(c.isMutiColObj=u,c.originFieldName=s,u){const e=c.originFieldName.split(":");if(e.length<2)return null;c.fieldName=e[0],c.subFieldName=e[1]}else c.fieldName=c.originFieldName;return i[s]=c,c}checkColNeedParse(t,l,r){if(t.tableType===e.TableType.vertical){const e=t.verticalFieldDefine,n=l[r+e.typeRow],i=l[r+e.fieldRow];return!d(n)&&!d(i)}if(t.tableType===e.TableType.horizontal){return!d(l[r+1])}}transValue(e,t,l){let r,n=this._valueTransFuncMap[t.type];return n||(n=this._valueTransFuncMap.json),r=n(t,l),r}parseTableFile(t,l,r){const n=F(l);if(!n.SheetNames.length)return;const i=n.SheetNames,o=this.getTableDefine(l,n);for(let e=0;e<i.length;e++);if(!o)return null;let a,s;const c=this.isSheetRowEnd.bind(null,o),f=this.isSheetColEnd.bind(null,o),u=(e,t)=>!this.checkRowNeedParse(o,e,t),g=(e,t)=>!this.checkColNeedParse(o,e,t);let p;r.tableDefine=o,h.log(`[parseTable|\u89e3\u6790\u6587\u4ef6]=> ${l.filePath}`);for(let t=0;t<i.length;t++)if(a=i[t],s=n.Sheets[a],this.checkSheetCanParse(o,s,a))if(r.curSheetName=a,h.log(`|=[parseSheet|\u89e3\u6790\u5206\u8868]=> ${a}`),o.tableType===e.TableType.vertical){let e;m(s,o.startRow,o.startCol,((t,l,n)=>{let i=!1;e!==n&&(e=n,i=!0),p=t[l+n],d(p)||this.parseVerticalCell(r,t,l,n,i)}),c,f,u,g)}else if(o.tableType===e.TableType.horizontal){let e;y(s,o.startRow,o.startCol,((t,l,n)=>{let i=!1;e!==l&&(e=l,i=!0),p=t[l+n],d(p)||this.parseHorizontalCell(r,t,l,n,i)}),c,f,u,g)}return r}}class C{onStart(e,t){h.systemLog("convert-hook onStart"),t()}onParseBefore(e,t){h.systemLog("convert-hook onParseBefore"),t()}onParseAfter(e,t){e.outputTransformer.transform(e,t)}onWriteFileEnd(e){h.systemLog("convert-hook onWriteFileEnd \u5199\u5165\u7ed3\u675f")}}const D={int:"number",json:"any","[int]":"number[]","[string]":"string[]"};class O{transform(t,l){const i=t.convertConfig,o=t.parseResultMap;let a=i.outputConfig;if(!a)return void console.error("parseConfig.outputConfig is undefind");let s,c,u,h={},d={},g="",p="",b={};for(let t in o)s=o[t],s.tableDefine&&(c=s.tableDefine.tableName,u=h[c],u=u?Object.assign(u,s.tableObj):s.tableObj,h[c]=u,a.isGenDts&&void 0===b[c]&&(b[c]=s.tableDefine.tableType===e.TableType.horizontal,s.tableDefine.tableType===e.TableType.horizontal?g+="\treadonly "+c+"?: "+`IT_${c};`+f:g+=this._getOneTableTypeStr(c),void 0===a.isBundleDts&&(a.isBundleDts=!0),a.isBundleDts?p+=this._getSingleTableDts(s):this._addSingleTableDtsOutputFile(a,s,d)),a.clientSingleTableJsonDir&&this._addSingleTableJsonOutputFile(a,s,d));if(a.isGenDts){if(g="interface ITBase<T> { [key:string]:T}"+f+"interface IT_TableMap {"+f+g+"}"+f,a.isBundleDts){const e=a.bundleDtsFileName?a.bundleDtsFileName:"tableMap",t=r.join(a.clientDtsOutDir,`${e}.d.ts`);d[t]={filePath:t,data:g+p}}else{const e=r.join(a.clientDtsOutDir,"tableMap.d.ts");d[e]={filePath:e,data:g}}}if(a.clientBundleJsonOutPath){let e,t=a.clientBundleJsonOutPath;if(a.isCompress){const t={};let l,r;for(let e in h)if(b[e])t[e]=h[e];else{l=h[e],r={fieldValuesMap:{}};for(let e in l)r.fieldNames||(r.fieldNames=Object.keys(l[e])),r.fieldValuesMap[e]=Object.values(l[e]);t[e]=r}e=JSON.stringify(t)}else e=JSON.stringify(h);a.isZip&&(e=n.deflateSync(e)),d[t]={filePath:t,encoding:"string"!=typeof e?"binary":"utf-8",data:e}}if(t.outPutFileMap)for(let e in d)t.outPutFileMap[e]=d[e];else t.outPutFileMap=d;l()}_addSingleTableDtsOutputFile(e,t,l){if(!t.tableObj)return;let n=r.join(e.clientDtsOutDir,`${t.tableDefine.tableName}.d.ts`);if(!l[n]){const e=this._getSingleTableDts(t);e&&(l[n]={filePath:n,data:e})}}_getSingleTableDts(e){const t=e.tableDefine.tableName,l=e.filedMap;let r,n="interface IT_"+t+" {"+f,i={};for(let e in l)if(r=l[e],r)if(r.isMutiColObj){const e=r.fieldName;i[e]||(i[e]=""),i[e]+="\t\t/** "+r.text+" */"+f,i[e]+="\t\treadonly "+r.subFieldName+"?: "+(D[r.type]?D[r.type]:r.type)+";"+f}else n+="\t/** "+r.text+" */"+f,n+="\treadonly "+r.fieldName+"?: "+(D[r.type]?D[r.type]:r.type)+";"+f;for(let e in i)n+="\treadonly "+e+"?: {"+f+i[e],n+="\t}"+f;return n+="}"+f,n}_addSingleTableJsonOutputFile(e,t,l){const n=t.tableObj;if(!n)return;const i=t.tableDefine.tableName;let o=r.join(e.clientSingleTableJsonDir,`${i}.json`),a=JSON.stringify(n,null,"\t"),s=l[o];s?s.data=a:(s={filePath:o,data:a},l[o]=s)}_getOneTableTypeStr(e){return"\treadonly "+e+"?: ITBase<IT_"+e+">;"+f}}function w(e,t,l,r){let n;for(let i=t.length-1;i>=0;i--)n=l[t[i].filePath],n||(n={filePath:t[i].filePath}),n.tableObj||(n=r.parseTableFile(e,t[i],n)),n&&(l[t[i].filePath]=n)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function j(e,t,l,r){return new(l||(l=Promise))((function(n,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function a(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof l?t:new l((function(e){e(t)}))).then(o,a)}s((r=r.apply(e,t||[])).next())}))}function M(e,t){if(i.statSync(e).isDirectory()){const n=i.readdirSync(e);let o;for(var l=0;l<n.length;l++)o=r.join(e,n[l]),M(o,t)}else t(e)}function x(e,t,l){let r;const n=e.length;if(e&&n){let o=0;const a=r=>{r&&h.log(r,"error"),o++,t&&t(e[o-1].filePath,n,o,!r),o>=n&&l&&l(n)};for(let t=e.length-1;t>=0;t--)if(r=e[t],r.isDelete&&i.existsSync(r.filePath))i.unlinkSync(r.filePath);else{if(i.existsSync(r.filePath)&&i.statSync(r.filePath).isDirectory()){h.log(`\u8def\u5f84\u4e3a\u6587\u4ef6\u5939:${r.filePath}`,"error");continue}r.encoding||"string"!=typeof r.data||(r.encoding="utf8"),i.ensureFileSync(r.filePath),i.writeFile(r.filePath,r.data,r.encoding?{encoding:r.encoding}:void 0,a)}}}function R(e,t){e?i.writeFileSync(e,JSON.stringify(t),{encoding:"utf-8"}):h.log("cacheFilePath is null","error")}function _(e){if(!e)return void h.log("cacheFilePath is null","error");i.existsSync(e)||(i.ensureFileSync(e),i.writeFileSync(e,"{}",{encoding:"utf-8"}));const t=i.readFileSync(e,"utf-8");return JSON.parse(t)}function $(e){const t=i.readFileSync(e,"utf-8");var l=o.createHash("md5");return l.update(t),l.digest("hex")}const E=".excel2all";function k(e,t,l,n){return j(this,void 0,void 0,(function*(){const i=e.convertConfig,o=e.parseResultMap;if(i.useCache&&!e.hasError&&R(t,o),yield new Promise((t=>{l.onParseAfter(e,t)})),e.outPutFileMap){const t=e.outPutFileMap,l=Object.values(t);h.systemLog(`\u5f00\u59cb\u5199\u5165\u6587\u4ef6:0/${l.length}`),yield new Promise((e=>{x(l,((e,t,l,r)=>{h.log(`[\u5199\u5165\u6587\u4ef6] \u8fdb\u5ea6:(${l}/${t}) \u8def\u5f84:${e}`)}),(()=>{e()}))})),h.systemLog("\u5199\u5165\u7ed3\u675f~")}else h.systemLog("\u6ca1\u6709\u53ef\u5199\u5165\u6587\u4ef6~");if(n||(n=h.logStr),""!==n.trim()){let t=e.convertConfig.outputLogDirPath;t||(t=E),r.isAbsolute(t)||(t=r.join(e.convertConfig.projRoot,t));x([{filePath:r.join(t,"excel2all.log"),data:n}])}l.onWriteFileEnd(e)}))}return e.ACharCode=65,e.DefaultConvertHook=C,e.DefaultOutPutTransformer=O,e.DefaultParseHandler=S,e.Logger=h,e.ZCharCode=90,e.charCodesToString=p,e.convert=function(e){return j(this,void 0,void 0,(function*(){let t,l;e.projRoot||(e.projRoot=process.cwd()),t=e.customConvertHookPath?require(e.customConvertHookPath):new C,l=e.customOutPutTransformerPath?require(e.customOutPutTransformerPath):new O;const n=e.tableFileDir;if(!n)return void h.log("\u914d\u7f6e\u8868\u76ee\u5f55\uff1atableFileDir\u4e3a\u7a7a","error");if(!i.existsSync(n))return void h.log(`\u914d\u7f6e\u8868\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\uff1a${n}`,"error");const o=["**/*.{xlsx,csv}","!**/~$*.*","!**/~.*.*"];e.pattern||(e.pattern=o),e.useMultiThread&&isNaN(e.threadParseFileMaxNum)&&(e.threadParseFileMaxNum=5),h.init(e);const c={convertConfig:e,outputTransformer:l};yield new Promise((e=>{t.onStart(c,e)}));let f=[],u=[];const d=e.pattern,g=(e,t)=>{const l=(e=>{const t=r.parse(e);return{filePath:e,fileName:t.name,fileExtName:t.ext,isDelete:!1}})(e);let n;return t?u.push(l):(n=a.all(l.filePath,d),n&&f.push(l)),{fileInfo:l,canRead:n}};let p,b,m={},y=e.cacheFileDirPath;if(e.useCache){y||(y=E),r.isAbsolute(y)||(y=r.join(e.projRoot,y)),p=r.join(y,".e2aprmc"),m=_(p),m||(m={});const t=Object.keys(m);let l,i;M(n,(e=>{var r=$(e);if(i=m[e],i||(i={filePath:e},m[e]=i),i&&i.md5hash!==r){const{fileInfo:t,canRead:l}=g(e,!1);l&&(i.md5hash=r)}if(l=t.indexOf(e),l>-1){const e=t[t.length-1];t[l]=e,t.pop()}}));for(let e=0;e<t.length;e++)delete m[t[e]],g(t[e],!0)}else M(n,g);if(e.customParseHandlerPath){if(b=require(e.customParseHandlerPath),!b||"function"!=typeof b.parseTableFile)return void console.error(`\u81ea\u5b9a\u4e49\u89e3\u6790\u5b9e\u73b0\u9519\u8bef:${e.customParseHandlerPath}`)}else b=new S;if(c.parseResultMap=m,c.deleteFileInfos=u,c.changedFileInfos=f,yield new Promise((e=>{t.onParseBefore(c,e)})),f.length>e.threadParseFileMaxNum&&e.useMultiThread){let l="";const n=Math.floor(f.length/e.threadParseFileMaxNum)+1;let i,o,a=0;const u=(new Date).getTime(),d=e=>{h.log(`----------------\u7ebf\u7a0b\u7ed3\u675f:${e.threadId}-----------------`);const r=e.parseResultMap;for(let e in r)m[e].tableDefine||(m[e]=r[e]);if(a++,l+=e.logStr+h.logStr,c.hasError||(c.hasError=h.hasError),a>=n){const e=(new Date).getTime();h.log("[\u591a\u7ebf\u7a0b\u5bfc\u8868\u65f6\u95f4]:"+(e-u)),k(c,p,t,l)}};for(let t=0;t<n;t++)o=f.splice(0,e.threadParseFileMaxNum),h.log(`----------------\u7ebf\u7a0b\u5f00\u59cb:${t}-----------------`),i=new s.Worker(r.join(r.dirname(__filename),"../../../worker_scripts/worker.js"),{workerData:{threadId:t,fileInfos:o,parseResultMap:m,convertConfig:e}}),i.on("message",d)}else{const l=(new Date).getTime();w(e,f,m,b);const r=(new Date).getTime();h.systemLog("[\u5355\u7ebf\u7a0b\u5bfc\u8868\u65f6\u95f4]:"+(r-l)),c.hasError=h.hasError,k(c,p,t)}}))},e.doParse=w,e.forEachChangedFile=function(e,t,l){const r=_(t),n=Object.keys(r);let o;M(e,(e=>{var t=$(e);if((!r[e]||r[e]&&r[e]!==t)&&(r[e]=t,l(e,!1)),o=n.indexOf(e),o>-1){const e=n[n.length-1];n[o]=e,n.pop()}}));for(let e=0;e<n.length;e++)delete r[n[e]],l(n[e],!0);i.writeFileSync(t,JSON.stringify(r),{encoding:"utf-8"})},e.forEachFile=M,e.getCacheData=_,e.getFileMd5=function(e){return j(this,void 0,void 0,(function*(){return $(e)}))},e.getFileMd5Sync=$,e.getNextColKey=g,e.horizontalForEachSheet=y,e.isCSV=N,e.isEmptyCell=d,e.readTableFile=F,e.stringToCharCodes=b,e.testFileMatch=function(e){e.projRoot||(e.projRoot=process.cwd()),e.customConvertHookPath&&require(e.customConvertHookPath);const t=e.tableFileDir;if(!t)return void h.log("\u914d\u7f6e\u8868\u76ee\u5f55\uff1atableFileDir\u4e3a\u7a7a","error");if(!i.existsSync(t))return void h.log(`\u914d\u7f6e\u8868\u6587\u4ef6\u5939\u4e0d\u5b58\u5728\uff1a${t}`,"error");const l=["**/*.{xlsx,csv}","!**/~$*.*","!**/~.*.*"];e.pattern||(e.pattern=l),e.useMultiThread&&isNaN(e.threadParseFileMaxNum)&&(e.threadParseFileMaxNum=5);const n=e.pattern,o=[],s=(e,t)=>{let l;return t||(l=a.all(e,n),l&&o.push(e)),{canRead:l}};let c,f,u=e.cacheFileDirPath;if(e.useCache){u||(u=".cache"),r.isAbsolute(u)||(u=r.join(e.projRoot,u)),c=r.join(u,".egfprmc"),f=_(c),f||(f={});const l=Object.keys(f);let n,i;M(t,(e=>{var t=$(e);if(i=f[e],i||(i={filePath:e},f[e]=i),i&&i.md5hash!==t){const{canRead:l}=s(e,!1);l&&(i.md5hash=t)}if(n=l.indexOf(e),n>-1){const e=l[l.length-1];l[n]=e,l.pop()}}));for(let e=0;e<l.length;e++)delete f[l[e]],s(l[e],!0)}else M(t,s);e.useCache&&console.log("----\u3010\u7f13\u5b58\u6a21\u5f0f\u3011----"),console.log("------------------------------\u5339\u914d\u5230\u7684\u6587\u4ef6---------------------"),console.log(o)},e.valueTransFuncMap=c,e.verticalForEachSheet=m,e.writeCacheData=R,e.writeOrDeleteOutPutFiles=x,Object.defineProperty(e,"__esModule",{value:!0}),e}({},os,xlsx,path,zlib,fs,crypto,mmatch,worker_threads),globalTarget=window||global;globalTarget.excel2all?Object.assign({},globalTarget.excel2all):globalTarget.excel2all=excel2all;
